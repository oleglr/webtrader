{"version":3,"sources":["../../../../src/common/rivetsExtra.es6"],"names":["hasValue","value","Boolean","rivets","_","View","prototype","observe","keypath","callback","model","models","inx","indexOf","substring","adapters","rv","formatters","i18n","replace","prop","args","i","length","trim","eq","other","vlaue","currency","formatPrice","undefined","decimal_points","addComma","capitalize","read","publish","toLowerCase","digits","$","isNumeric","toFixed","defer","checkbox","first","second","fn","bind","array","field","map","condition","currency_symbols","epoch","d","Date","getUTCHours","slice","getUTCMinutes","getUTCSeconds","format","moment","utc","from_epoch","till_epoch","ret","seconds","duration","days","hours","minutes","str","last","changed","original","percentage_of_amount","debounce","timeout","clearTimeout","_timer_notify","setTimeout","filter","e","binders","selectmenu","priority","publishes","el","select","classes","change","val","trigger","unbind","routine","find","split","$input","reg","on","is_ok","test","method","appendto","css","selectrefresh","array_or_value","chosen","disablingElement","click","stopPropagation","width","next","prepend","chosenrefresh","chosendisable","chosenContainer","inputElement","chosenDrop","chosenDisableElement","attr","hide","addClass","removeAttr","show","removeClass","widget","ui","spinner","_buttonHtml","btn","dir","icon","step","radius","right","options","step_big","input","webtrader_spinner","stop","spin","currentTarget","decimals","preventDefault","keyup","event","keyCode","function","dialog","color","altField","after","colorpicker","showOn","position","my","of","collision","parts","alpha","layout","bar","colorFormat","part","size","parent","scrollParent","scroll","slider","div","handle","append","min","max","create","text","slide","datepicker_mindate","datepicker","styles","marginTop","marginLeft","numberOfMonths","dateFormat","showAnim","showButtonPanel","changeMonth","changeYear","onSelect","beforeShow","inst","dpDiv","closeText","currentText","yearRange","maxDate","minDate","dpicker","blur","_gotoToday","id","timepicker","allways_ok","showPeriod","showLeadingZero","showCloseButton","showNowButton","onHourShow","onMinuteShow","tpDiv","hourText","minuteText","amPmText","closeButtonText","nowButtonText","deselectButtonText","menu","data","jquery_selector","style","getHiddenOffsetWidth","$hiddenElement","clone","appendTo","outerWidth","remove","cur_font","$el","fontSize","display","visibility","disabled","animate","scrollTop","scrollHeight","height","remove_all_matches_except_first","string","regex","count","replaceWith","match","listener","symbol","startsWith","_listener","off","getValue","console","warn","decimalPlaces","num","Math","max_nr_of_decimals","setAttribute","spots","chart","config","type","lineColor","fillColor","spotColor","minSpotColor","maxSpotColor","highlightSpotColor","highlightLineColor","spotRadius","sparkline","perv","_perv_indicative_color","red","green","black","component_twoway_bind","self","keypathes","key","observer","observers","target","updated","componentView","setValue","components","static","template","initialize","attributes","view","state"],"mappings":"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","file":"rivetsExtra.js","sourcesContent":["﻿import _ from 'lodash';\r\nimport $ from 'jquery';\r\nimport rv from 'rivets';\r\nimport moment from 'moment';\r\nimport 'jquery-ui';\r\nimport 'jquery-sparkline';\r\nimport 'chosen';\r\nimport 'color-picker';\r\n\r\nconst hasValue = value => value === 0 ? true : Boolean(value);\r\n\r\n/* Rivets js does not allow manually observing properties from javascript,\r\n       Use \"rv.bind().observe('path.to.object', callback)\" to subscribe */\r\nrivets._.View.prototype.observe = function (keypath, callback) {\r\n   let model = this.models, inx = 0;\r\n   while ((inx = keypath.indexOf('.')) !== -1) {\r\n      model = model[keypath.substring(0,inx)];\r\n      keypath = keypath.substring(inx + 1);\r\n   }\r\n   this.adapters['.'].observe(model, keypath,\r\n      () => callback(model[keypath])\r\n   );\r\n};\r\n\r\n/************************************* formatters ***************************************/\r\n\r\n/* rivets formatter to translate strings to 18n */\r\nrv.formatters['i18n'] = (value) => {\r\n   if (typeof value === 'string') return value.i18n();\r\n   return value;\r\n};\r\nrv.formatters['sanitize'] = (value) => value.replace(/(\"|'|\\&|\\(|\\)|\\<|\\>|\\;)/g, '');\r\n/* rivets formatter to get the property value of an object */\r\nrv.formatters['prop'] = (value, prop) => {\r\n   return value && value[prop];\r\n};\r\n/* rivets formatter to check if a value is one of the given args */\r\nrv.formatters['one-of'] = (...args) => {\r\n   const value = args[0];\r\n   for (let i = 1; i < args.length ; ++i)\r\n      if (args[i] === value)\r\n         return true;\r\n   return false;\r\n}\r\n/* rivets formatter to trim a string */\r\nrv.formatters['trim'] = (value) => _.trim(value);\r\n/* rivets formatter to negate a value */\r\nrv.formatters['negate'] = (value) => !value;\r\n/* rivets formatter to check equality of two values */\r\nrv.formatters.eq = (value, other) => value === other;\r\n/* formatter to check not-equality of values */\r\nrv.formatters['not-eq'] = (value, other) => value !== other;\r\n/* rivets formatter to replace a falsy value with a default one */\r\nrv.formatters['or'] = (value, other) => value || other;\r\n/* rivets formatter to replace a falsy value with a default one */\r\nrv.formatters['or-not'] = (value, other) => value || !other;\r\n/* rivets formatter to replace a true value with a default one */\r\nrv.formatters['and'] = (vlaue, other) => vlaue && other;\r\n/* rivets formatter and not  */\r\nrv.formatters['and-not'] = (vlaue, other) => vlaue && !other;\r\n/* rivets formatter for > operator  */\r\nrv.formatters['gt'] = (vlaue, other) => vlaue > other;\r\n/* rivets formatter for < operator  */\r\nrv.formatters['lt'] = (vlaue, other) => vlaue < other;\r\n/* rivets formatter to check if a variable has value */\r\nrv.formatters['has-value'] = hasValue;\r\n/* localise price format*/\r\nrv.formatters['format-price'] = (value, currency) => hasValue(value) ? formatPrice(value, currency) : undefined;\r\n/* comma added format*/\r\nrv.formatters['add-comma'] = (value, decimal_points) => value ?  addComma(value, decimal_points) : undefined;\r\n/* rivets formater to capitalize string */\r\nrv.formatters.capitalize = {\r\n   read: (value) => _.capitalize(value),\r\n   publish: (value) => value.toLowerCase()\r\n};\r\n/* call toFixed on a fload number */\r\nrv.formatters['to-fixed'] = (value, digits) => {\r\n   if (!$.isNumeric(value) || !$.isNumeric(digits)){\r\n      return;\r\n   }\r\n   return (value * 1).toFixed(digits || 2);\r\n}\r\n/* notify other functions on property changes */\r\nrv.formatters['notify'] = (...args) => {\r\n   const value = args[0];\r\n   for (let i = 1; i < args.length ; ++i)\r\n      _.defer(args[i], value);\r\n   return value;\r\n}\r\n/* rv 2-way formatter for checkboxes */\r\nrv.formatters.checkbox = {\r\n   read: (value, first, second) => _.trim(value, \" '\\\"\") == first,\r\n   publish: (value, first, second) => _.trim(value ? first: second, \" '\\\"\"),\r\n}\r\n/* rv formmatter to bind a given function to a value */\r\nrv.formatters['bind'] = (fn, value) => fn.bind(undefined, value);\r\n\r\nrv.formatters['map'] = (array, field) => _.map(array, field);\r\n/* rv formatter to prepend a value */\r\nrv.formatters['prepend'] = (value, other) => (other && value) ? other + value : value;\r\n/* rv formatter to append a value */\r\nrv.formatters['append'] = (value, other) => (other && value) ? value + other : value;\r\n/* ternary operator (condition ? first : second) */\r\nrv.formatters['ternary'] = (condition, first, second) => condition ? first : second;\r\n/* formatter to add a currency symbol before the value */\r\nrv.formatters.currency = (value, currency) => {\r\n   const currency_symbols = {\r\n      'USD': '$', /* US Dollar */ 'EUR': '€', /* Euro */ 'CRC': '₡', /* Costa Rican Colón */\r\n      'GBP': '£', /* British Pound Sterling */ 'ILS': '₪', /* Israeli New Sheqel */\r\n      'INR': '₹', /* Indian Rupee */ 'JPY': '¥', /* Japanese Yen */\r\n      'KRW': '₩', /* South Korean Won */ 'NGN': '₦', /* Nigerian Naira */\r\n      'PHP': '₱', /* Philippine Peso */ 'PLN': 'zł', /* Polish Zloty */\r\n      'PYG': '₲', /* Paraguayan Guarani */ 'THB': '฿', /* Thai Baht */\r\n      'UAH': '₴', /* Ukrainian Hryvnia */ 'VND': '₫', /* Vietnamese Dong */\r\n   };\r\n   if (value)\r\n      return (currency_symbols[currency] || currency) + value;\r\n   return value;\r\n}\r\n/* formatter to convert epoch to utc-time in hh:mm:ss format */\r\nrv.formatters['utc-time'] = (epoch) => {\r\n   const d = new Date(epoch * 1000); /* since unixEpoch is simply epoch / 1000, we  multiply the argument by 1000 */\r\n   return (\"00\" + d.getUTCHours()).slice(-2) + \":\" +\r\n      (\"00\" + d.getUTCMinutes()).slice(-2) + \":\" +\r\n      (\"00\" + d.getUTCSeconds()).slice(-2);\r\n}\r\nrv.formatters['moment'] = (epoch, format) => {\r\n   format = format || 'YYYY-MM-DD HH:mm:ss';\r\n   return epoch && moment.utc(epoch*1000).format(format);\r\n}\r\n/* human readable difference of two epoch values */\r\nrv.formatters['moment-humanize'] = (from_epoch, till_epoch) => {\r\n   if (!from_epoch || !till_epoch) {\r\n      return undefined;\r\n   }\r\n\r\n   let ret = '';\r\n   const seconds = till_epoch - from_epoch;\r\n   const duration = moment.duration(seconds, 'seconds');\r\n   if (duration.days() > 0)\r\n      ret += ' ' + duration.days() + ' ' + (duration.days() > 1 ? 'days' : 'day');\r\n   if (duration.hours() > 0)\r\n      ret += ' ' + duration.hours() + ' ' + (duration.hours() > 1 ? 'hours' : 'hour');\r\n   if (duration.minutes() > 0)\r\n      ret += ' ' + duration.minutes() + ' ' + (duration.minutes() > 1 ? 'minutes' : 'minute');\r\n   if (duration.seconds() > 0 && seconds < 10*60)\r\n      ret += ' ' + duration.seconds() + ' ' + (duration.seconds() > 1 ? 'seconds' : 'second');\r\n\r\n   return _.trim(ret).i18n();\r\n}\r\n/* formatter to bold last character */\r\nrv.formatters['bold-last-character'] = (str) => {\r\n   str = str + '';\r\n   return str.substring(0, str.length - 1) + '<strong>' + _.last(str) + '</strong>';\r\n}\r\n/* formatter to calcualte the percent of a value of another value */\r\nrv.formatters['percent-of'] = (changed, original) => {\r\n   if (!(changed != null) || !original) return undefined;\r\n   const percentage_of_amount = (100*(changed - original)/original).toFixed(2);\r\n   if (percentage_of_amount > 0) {\r\n     return `+${percentage_of_amount}%`;\r\n   }\r\n   return `${percentage_of_amount}%`;\r\n}\r\n\r\nrv.formatters.length = (value) => value.length;\r\n\r\n/* Debouncing enforces that a function not be called again until a certain amount of time has passed without it being called.\r\n       As in \"execute this function only if 100 milliseconds have passed without it being called.\" */\r\nrv.formatters.debounce = (value, callback, timeout = 250) => {\r\n   clearTimeout(callback._timer_notify);\r\n   callback._timer_notify = setTimeout(callback.bind(undefined,value), timeout);\r\n   return value;\r\n}\r\n// Filter array based on property.\r\nrv.formatters.filter = (array, prop, value) => _.filter(array, (e) => e[prop] === value );\r\n/* turn current select item into a jquery-ui-selectmenu, update value on change */\r\nrv.binders.selectmenu = {\r\n   priority: 101,\r\n   publishes: true,\r\n   bind: function (el) {\r\n      const publish = this.publish,\r\n         select = $(el);\r\n      select.selectmenu({\r\n         classes: {\r\n           \"ui-selectmenu-button\": \"ui-selectmenu-button ui-state-default\"\r\n         },\r\n         change: () => {\r\n            publish(select.val());\r\n            select.trigger('change');\r\n         }\r\n      });\r\n   },\r\n   unbind: (el) => $(el).selectmenu( \"destroy\" ),\r\n   routine: (el, value) => {\r\n      el = $(el);\r\n      el.val(value);\r\n      if (el.find(\"option[value='\" + value + \"']\").length > 0)\r\n         el.selectmenu('refresh');\r\n   }\r\n};\r\n\r\nrv.binders['is-valid-number'] = {\r\n   priority: 100,\r\n   publishes: true,\r\n   bind: function (el) {\r\n      const prop = this.keypath.split('.')[1];\r\n      const model = this.model;\r\n      const $input = $(el);\r\n      const reg = /^(?!0\\d)\\d*(\\.\\d{1,4})?$/;\r\n\r\n      $input.on('input', () => {\r\n         const val = $input.val();\r\n         const is_ok = reg.test(val);\r\n\r\n         model[prop] = is_ok && val !== '';\r\n      });\r\n   },\r\n   unbind: (el) => { },\r\n   routine: (el, value) => { }\r\n}\r\n\r\n/* bindar for jqueyr ui selectmenu options */\r\nrv.binders['dom-*'] = function (el, value) {\r\n   const method = this.args[0];\r\n   if (value)\r\n      setTimeout(() => el[method](), 0);\r\n};\r\n\r\n/* bindar for jqueyr ui selectmenu options */\r\nrv.binders['selectmenu-*'] = function (el, value) {\r\n   this.args[0] = {appendto: 'appendTo'}[this.args[0]] || this.args[0];\r\n   $(el).selectmenu('option', this.args[0], value);\r\n}\r\n/*binder for hidding overflow on selctmenu*/\r\nrv.binders['selectmenu-css-*'] = function(el,value) {\r\n   $(el).selectmenu(\"menuWidget\").css(this.args[0], value);\r\n}\r\n\r\n/* refersh the selectmenu on array changes */\r\nrv.binders.selectrefresh = {\r\n   priority: 99,\r\n   routine: (el,array_or_value) => {\r\n      el = $(el);\r\n      if (typeof array_or_value === 'string') {\r\n         el.val(array_or_value);\r\n         if (el.find(\"option[value='\" + array_or_value+ \"']\").length === 0)\r\n            return;\r\n      }\r\n      el.selectmenu('refresh');\r\n   }\r\n}\r\n\r\n/* Multiselect select menu \"chosen\"*/\r\nrv.binders.chosen = {\r\n   priority: 100,\r\n   publishes: true,\r\n   bind: function(el){\r\n      const publish = this.publish;\r\n     //The disabling overlay element. chosen-disable is defined in main.css\r\n     //There is no real CSS class webtrader-chosen-disable\r\n     const disablingElement = $('<div class=\"webtrader-chosen-disable chosen-disable\"></div>');\r\n     disablingElement.click(e => e.stopPropagation());\r\n      $(el).chosen({width:$(el).css(\"width\")}).change(function() {\r\n         publish($(this).val())\r\n      });\r\n     $(el).next() //Select the chosen generated element\r\n      .prepend(disablingElement);\r\n   },\r\n   unbind: (el) => $(el).chosen(\"destroy\")\r\n};\r\n\r\n/* binder for chosen refresh */\r\nrv.binders.chosenrefresh = (el) => $(el).trigger(\"chosen:updated\");\r\n\r\n/* binder for disabling chosen */\r\nrv.binders.chosendisable = (el, value) => {\r\n  const chosenContainer = $(el).next();\r\n  const inputElement = chosenContainer.find('.chosen-choices input');\r\n  const chosenDrop = chosenContainer.find('.chosen-drop');\r\n  const chosenDisableElement = chosenContainer.find('.webtrader-chosen-disable');\r\n  if (value) {\r\n    inputElement.attr('disabled', value);\r\n    chosenDrop.hide();\r\n    chosenDisableElement.addClass('chosen-disable');\r\n  } else {\r\n    inputElement.removeAttr('disabled');\r\n    chosenDrop.show();\r\n    chosenDisableElement.removeClass('chosen-disable');\r\n  }\r\n};\r\n\r\n/* extend jquery ui spinner to support multiple buttons */\r\n$.widget('ui.webtrader_spinner', $.ui.spinner, {\r\n   _buttonHtml: function () {\r\n      const btn = (dir, icon, step, radius, right) => {\r\n         icon = 'ui-icon-' + icon + '-1-' + (dir === 'up' ? 'n' : 's');\r\n         right = 'right: ' + (right || '0px') + ';';\r\n         radius = radius || '5px';\r\n         radius = 'border-radius: 0 ' + (dir == 'up' ? radius + ' 0' : '0 ' + radius) + ' 0';\r\n\r\n         return \"<button step='\" + step + \"' class='ui-spinner-button ui-spinner-\" + dir +\r\n            \"' style='\" + right + radius + \"'>\" +\r\n            \"<span class='ui-icon \" + icon +\"'>&#9650;</span>\" +\r\n            \"</button>\";\r\n      }\r\n\r\n      let ret = '';\r\n      ret += btn('up', 'triangle', this.options.step_big || this.options.step, '5px');\r\n      ret += btn('down', 'triangle', '-' +(this.options.step_big || this.options.step), '5px');\r\n      return ret;\r\n   }\r\n});\r\n/* turn input element into jquery-ui-spinner, model = {min:, max, value:},\r\n        the element can have attributes like 'step' and in additoin an new attribute named 'step-big'.\r\n        the value of these attrebutes will be used to increment/decrement on button press.  */\r\nrv.binders.spinner = {\r\n   priority: 98,\r\n   publishes: true,\r\n   bind: function (el) {\r\n      const model = this.model;\r\n      const publish = this.publish;\r\n      const input = $(el);\r\n      input.webtrader_spinner({\r\n         stop: () => {\r\n            const value = input.val();\r\n            publish(value * 1);\r\n         },\r\n         spin: function (e,ui) {\r\n            const step = $(e.currentTarget).attr('step') + '';\r\n            const decimals = (step.split('.')[1] || []).length;\r\n            value = $(this).val()*1 + step*1;\r\n            $(this).val(value.toFixed(decimals));\r\n            e.preventDefault();\r\n         },\r\n         step: input.attr('step') || 1,\r\n         step_big: input.attr('step-big') || null\r\n      });\r\n   },\r\n   unbind: (el) => $(el).webtrader_spinner('destroy'),\r\n   routine: (el,value) => $(el).webtrader_spinner('value', value*1)\r\n};\r\n\r\n/* bind to pressing Enter key in input*/\r\nrv.binders['input-enter'] = {\r\n   priority: 93,\r\n   publishes: false,\r\n   routine: (el, callback) => {\r\n      $(el).keyup(function(event){\r\n         if (event.keyCode == 13){\r\n            callback(el);\r\n         }\r\n      });\r\n   },\r\n   function: true\r\n}\r\n/* bind values to jquery ui spinner options like 'min', 'max', ... */\r\nrv.binders['spinner-*'] = function(el,value) {\r\n   $(el).webtrader_spinner('option', this.args[0], value);\r\n}\r\n\r\n/* bindar for jqueyr ui dialog options */\r\nrv.binders['dialog-*'] = function (el, value) {\r\n   $(el).dialog('option', this.args[0], value);\r\n}\r\nrv.binders['color-picker'] = {\r\n   priority: 96,\r\n   publishes: true,\r\n   bind: function (el) {\r\n      const input = $(el);\r\n\r\n      const publish = this.publish;\r\n      const model = this.model;\r\n      const color = model.value || '#cd0a0a';\r\n\r\n      const altField = $('<div style=\"width:100%;\"/>');\r\n      input.after(altField);\r\n\r\n      input.colorpicker({\r\n         showOn: 'alt',\r\n         altField: altField,\r\n         position: {\r\n            my: \"left-100 bottom+5\",\r\n            of: \"element\",\r\n            collision: \"fit\"\r\n         },\r\n         parts:  [ 'map', 'bar' ],\r\n         alpha:  true,\r\n         layout: {\r\n            map: [0, 0, 2, 2],\r\n            bar: [2, 0, 1, 2],\r\n         },\r\n         colorFormat: \"RGBA\",\r\n         part: { map: {size: 128}, bar: {size: 128} },\r\n         select: (event, color) => publish(color)\r\n      });\r\n\r\n      setTimeout(() => {\r\n         parent = input.scrollParent();\r\n         parent.scroll(\r\n            () => input.colorpicker('close')\r\n         );\r\n      }, 1000);\r\n   },\r\n   unbind: (el) => { },\r\n   routine: (el, value) => { }\r\n}\r\n\r\nrv.binders.slider = {\r\n   priority: 95,\r\n   publishes: true,\r\n   bind: function (el) {\r\n      const div = $(el);\r\n      const handle = $('<div class=\"ui-slider-handle\"></div>');\r\n      div.append(handle);\r\n\r\n      const publish = this.publish;\r\n      const model = this.model;\r\n\r\n      div.slider({\r\n         step: div.attr('step')*1 || 1,\r\n         min: div.attr('min') === undefined ? 1 : div.attr('min')*1,\r\n         max: div.attr('max')*1 || 100,\r\n         create: function() {\r\n            handle.text($(this).slider(\"value\"));\r\n         },\r\n         slide: ( event, ui ) => {\r\n            handle.text(ui.value);\r\n            model.value = ui.value*1;\r\n         }\r\n      });\r\n   },\r\n   unbind: (el) => $(el).slider('destroy'),\r\n   routine: (el, value) => {\r\n      $(el).slider('value', value);\r\n      $(el).find('> div').text(value);\r\n   }\r\n}\r\n\r\nrv.binders.datepicker_mindate = {\r\n   routine: (el, value) => $(el).datepicker('option', 'minDate', value)\r\n}\r\n\r\n/* trun input element in jquery-ui-datepicker */\r\nrv.binders.datepicker = {\r\n   priority: 94,\r\n   publishes: true,\r\n   bind: function (el) {\r\n      const input = $(el);\r\n      const publish = this.publish;\r\n      const model = this.model;\r\n      const styles = { marginTop: input.attr('marginTop') || '0px', marginLeft: input.attr('marginLeft') || '0px' };\r\n\r\n      const options = {\r\n         showOn: model.showOn || 'focus',\r\n         numberOfMonths: input.attr('numberOfMonths')*1 || 2,\r\n         dateFormat: model.dateFormat || 'yy-mm-dd',\r\n         showAnim: model.showAnim ||  'drop',\r\n         showButtonPanel: model.showButtonPanel !== undefined ? model.showButtonPanel : true,\r\n         changeMonth: model.changeMonth || true,\r\n         changeYear: model.changeYear || true,\r\n         onSelect: function () { $(this).change(); },\r\n         beforeShow: (input, inst) => inst.dpDiv.css(styles),\r\n         closeText: 'Done'.i18n(),\r\n         currentText: 'Today'.i18n()\r\n      };\r\n      if (model.yearRange)\r\n         options.yearRange = model.yearRange;\r\n      else {\r\n         options.maxDate = model.maxDate || null;\r\n         options.minDate = model.minDate || 0;\r\n      }\r\n\r\n      const dpicker = input.datepicker(options);\r\n      input.on('change', () => {\r\n         const value = input.val();\r\n         publish(value);\r\n         input.blur(); // remove focus from input\r\n      });\r\n\r\n      $.datepicker._gotoToday = (id) => {\r\n         $(id).datepicker('setDate', new Date()).change().datepicker('hide');\r\n      };\r\n   },\r\n   unbind: (el) => $(el).datepicker('destroy'),\r\n   /* value could be Date() object or a string in yyyy-mm-dd format */\r\n   routine: (el, value) => $(el).datepicker(\"setDate\", value)\r\n}\r\n\r\n/* truen input element in to jquery-ui-timepicker */\r\nrv.binders.timepicker = {\r\n   priority: 93,\r\n   publishes: true,\r\n   bind: function (el) {\r\n      const input = $(el);\r\n      const publish = this.publish;\r\n      const model = this.model;\r\n      const allways_ok = () => true;\r\n\r\n      const styles = { marginTop: input.attr('marginTop') || '0px', marginLeft: input.attr('marginLeft') || '0px' };\r\n      input.on('change', () => {\r\n         publish(input.val());\r\n         input.blur();\r\n      });\r\n\r\n      input.timepicker({\r\n         showPeriod: model.showPeriod || false,\r\n         showLeadingZero: model.showLeadingZero || true,\r\n         showCloseButton: model.showCloseButton || true,\r\n         showNowButton: model.showNowButton || false,\r\n         onHourShow: model.onHourShow || allways_ok,\r\n         onMinuteShow: model.onMinuteShow || allways_ok,\r\n         beforeShow: (input, inst) => inst.tpDiv.css(styles),\r\n         onSelect: function(){ $(this).change() },\r\n         hourText: 'Hour'.i18n(),\r\n         minuteText: 'Minute'.i18n(),\r\n         amPmText: ['AM'.i18n(), 'PM'.i18n()],\r\n         closeButtonText: 'Done'.i18n(),\r\n         nowButtonText: 'Now'.i18n(),\r\n         deselectButtonText: 'Deselect'.i18n()\r\n      });\r\n   },\r\n   unbind: (el) => $(el).timepicker('destroy'),\r\n   routine: (el, value) => $(el).val(value)\r\n}\r\n\r\n/* add a css class to corresponding jquery-ui widget from the dummy html element */\r\nrv.binders['jq-class'] = {\r\n   priority: 92,\r\n   routine: (el, value) => {\r\n      el = $(el);\r\n      const menu = $('#' + el.attr('id') + '-menu'); // get the id of widget\r\n      menu.removeClass(el.data('jq-class'));\r\n      el.data({ 'jq-class': value });\r\n      menu.addClass(value);\r\n   }\r\n}\r\n\r\n/* rv binder to active click event on another button when Enter key is pressed */\r\nrv.binders['input-default-btn'] = (el, jquery_selector) => {\r\n   $(el).keyup((event) => {\r\n      if (event.keyCode == 13) {\r\n         $(jquery_selector).click();\r\n      }\r\n   });\r\n}\r\n\r\n/* bindar for css attributes */\r\nrv.binders['css-*'] = function (el, value) {\r\n   const style = {};\r\n   style[this.args[0]] = value;\r\n   $(el).css(style);\r\n}\r\n\r\n$.fn.getHiddenOffsetWidth = function () {\r\n   // save a reference to a cloned element that can be measured\r\n   const $hiddenElement = $(this).clone().appendTo('body');\r\n   // calculate the width of the clone\r\n   const width = $hiddenElement.outerWidth();\r\n   // remove the clone from the DOM\r\n   $hiddenElement.remove();\r\n   return width;\r\n};\r\n/* scale the font-size to fit the text on the given width*/\r\nrv.binders['scale-font-size'] = (el, value) => {\r\n   let cur_font = 14;\r\n   const $el = $(el);\r\n   do {\r\n      el.style.fontSize = cur_font + 'px';\r\n      cur_font -= 1;\r\n   } while($el.getHiddenOffsetWidth() > value*1)\r\n}\r\n\r\nrv.binders['show'] = (el, value) => {\r\n   el.style.display = value ? '' : 'none';\r\n   return value;\r\n};\r\nrv.binders['visible'] = (el, value) => {\r\n   el.style.visibility = value ? 'visible' : 'hidden';\r\n   return value;\r\n};\r\n/* binder to add or remove disabled attribute */\r\nrv.binders.disabled = (el,value) => {\r\n   if (value) $(el).attr('disabled', 'disabled');\r\n   else $(el).removeAttr('disabled');\r\n}\r\n\r\n/* binder to scroll to buttom automatically */\r\nrv.binders['auto-scroll-bottom'] = {\r\n   priority: 91, /* run after native bindings */\r\n   routine: (el) => {\r\n      $(el).animate({ scrollTop: el.scrollHeight - $(el).height() }, 'slow');\r\n   }\r\n}\r\n\r\nfunction remove_all_matches_except_first(string, regex) {\r\n  let count = 0;\r\n  const replaceWith = '';\r\n  return string.replace(regex, (match) => {\r\n    count++;\r\n    return count === 1 ? match : replaceWith;\r\n  });\r\n}\r\n\r\nrv.binders['barrier-format'] = {\r\n   priority: 3001,\r\n   routine: (input) => {\r\n      const $input = $(input);\r\n      const listener = () => {\r\n        let val = $input.val();\r\n        let symbol = '';\r\n\r\n        if (val.startsWith('+') || val.startsWith('-')) symbol = val[0];\r\n        val = remove_all_matches_except_first(val, /\\./g);\r\n        val = val.replace(/[^\\d.]/g,'');\r\n        val = symbol + val;\r\n\r\n        $input.val(val);\r\n        $input.trigger('change');\r\n        return;\r\n      }\r\n      input._listener && $input.off('input', input._listener);\r\n      input._listener = listener;\r\n      $input.on('input', listener)\r\n   },\r\n   getValue: (el) => {\r\n     console.warn('getValue');\r\n     return el.value;\r\n   }\r\n};\r\n\r\nfunction decimalPlaces(num) {\r\n  const match = (''+num).match(/(?:\\.(\\d+))?(?:[eE]([+-]?\\d+))?$/);\r\n  let ret = 0;\r\n  if (match) {\r\n    ret = Math.max( 0, (match[1] ? match[1].length : 0) - (match[2] ? +match[2] : 0));\r\n  }\r\n  return ret;\r\n}\r\n\r\nrv.binders['number-format'] = {\r\n  priority: 3002,\r\n  routine: (input, max_nr_of_decimals) => {\r\n    const $input = $(input);\r\n    const listener = () => {\r\n      let val = $input.val();\r\n      val = remove_all_matches_except_first(val, /\\./g);\r\n      val = val.replace(/[^\\d.]/g,'');\r\n\r\n      if (decimalPlaces(val) > max_nr_of_decimals) val = (+val).toFixed(max_nr_of_decimals);\r\n\r\n      $input.val(val);\r\n      $input.trigger('change');\r\n      return;\r\n    }\r\n    input._listener && $input.off('input', input._listener);\r\n    input._listener = listener;\r\n    $input.on('input', listener)\r\n  }\r\n};\r\n\r\n/* binder with high priority to apply attributes first */\r\nrv.binders['attr-*'] = {\r\n   priority: 10*1000,\r\n   routine: function(el,value) {\r\n      el.setAttribute(this.args[0],value)\r\n   }\r\n}\r\n\r\n/* ticks: [ {quote: ''} ] */\r\nrv.binders['sparkline'] = (el, spots) => {\r\n   const chart = $(el);\r\n   const config = {\r\n      type: 'line',\r\n      lineColor: '#606060',\r\n      fillColor: false,\r\n      spotColor: '#00f000',\r\n      minSpotColor: '#f00000',\r\n      maxSpotColor: '#0000f0',\r\n      highlightSpotColor: '#ffff00',\r\n      highlightLineColor: '#000000',\r\n      spotRadius: 1.25\r\n   };\r\n   setTimeout(() => {\r\n      chart.sparkline(spots, config);\r\n      spots && spots.length ? chart.show() : chart.hide();\r\n   }, 0);\r\n}\r\n\r\n/* rv binder for indicative color change logic */\r\nrv.binders['indicative-color'] = (el, value) => {\r\n   const perv = (el._perv_indicative_color || 0)*1;\r\n   const red = '#d71818';\r\n   const green = '#02920e';\r\n   const black = 'black';\r\n   if (!$.isNumeric(value)) {\r\n      $(el).css({color: black});\r\n   }\r\n   else if (perv !== value*1) {\r\n      $(el).css({color: perv < value*1 ? green : red});\r\n   }\r\n   el._perv_indicative_color = value;\r\n}\r\n\r\n/******************************** components *****************************/\r\nconst component_twoway_bind = (self, data, keypathes) => {\r\n   /* make sure to call async */\r\n   setTimeout(() => {\r\n      for(let i = 0; i < keypathes.length; ++i){\r\n         const keypath = keypathes[i];\r\n         const key = _.last(keypath.split('.'));\r\n         const observer = self.observers[key];\r\n         if (observer) {\r\n            observer.options.adapters['.'].observe(observer.target, _.last(observer.keypath.split('.')), () => {\r\n               const updated = observer.target[_.last(observer.keypath.split('.'))];\r\n               data[key] = updated;\r\n            });\r\n            self.componentView.observe(keypath, (value) => observer.setValue(value));\r\n         }\r\n      }\r\n   }, 0);\r\n}\r\nrivets.components['price-spinner'] = {\r\n   static: ['class', 'min'],\r\n   template:\r\n   () => `<span class=\"ui-spinner ui-widget ui-widget-content ui-corner-all\" rv-attr-value=\"data.value\">\r\n               <input rv-class=\"data.class\" type=\"text\" rv-value=\"data.value\" rv-decimal-round=\"data.decimals | or 5\" no-symbol=\"no-symbol\" />\r\n             </span>`,\r\n   initialize: function(el, data) {\r\n      component_twoway_bind(this, data, ['data.value']);\r\n      //component_twoway_bind(this, data, ['data.decimals']);\r\n      return {\r\n         data: data\r\n      };\r\n   },\r\n};\r\n\r\nrivets.components['loader-dark'] = {\r\n  template: () =>\r\n    `<div class=\"barspinner dark\">\r\n      <div class=\"rect1\"></div>\r\n      <div class=\"rect2\"></div>\r\n      <div class=\"rect3\"></div>\r\n      <div class=\"rect4\"></div>\r\n      <div class=\"rect5\"></div>\r\n    </div>`,\r\n  initialize: function(el, attributes) {}\r\n};\r\n\r\nexport const bind = (view, state) => rv.bind(view, state);\r\nexport const formatters = rv.formatters;\r\nexport const binders = rv.binders;\r\n\r\nexport default {\r\n   bind,\r\n   formatters,\r\n   binders\r\n};\r\n"]}
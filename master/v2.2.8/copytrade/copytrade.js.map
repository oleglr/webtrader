{"version":3,"sources":["../../../../src/copytrade/copytrade.es6"],"names":["getLoggedInUserId","local_storage","get","id","TRADE_TYPES","trade_types","form_error_messages","INVALID_STAKE_LIMIT","i18n","TOKEN_ALREADY_ADDED","ENTER_VALID_TOKEN","REFRESH_FAILED","getStorageName","DEFAULT_TRADE_TYPES","slice","map","m","api_code","defaultCopySettings","traderApiToken","copy_start","min_trade_stake","max_trade_stake","assets","_","cloneDeep","DEFAULT_ASSETS","defaultTraderDetails","loginid","open","started","disableStart","yourCopySettings","validate_min_max_stake","yourCopySettingsData","updateLocalStorage","debounce","clonedScope","scope","searchToken","disable","set","GROUPED_INTRUMENTS","then","flatten","instruments","displayName","display_name","submarkets","mm","forEach","eGrp","eSubGrp","symbol","push","code","name","state","masterAssetList","groupedAssets","filter","f","refreshTraderStats","token","Promise","resolve","reject","liveapi","send","copytrading_statistics","trader_id","copyStatData","traderTokenDetails","find","traderTokens","merge","traderStatistics","catch","e","win","win_view","masterTradeTypeList","is_loading","allowCopy","allow_copiers","onAllowCopyChangeCopierCellClick","onChangeCopytradeSettings","onAllowCopyChangeTraderCellClick","set_settings","settings","$","growl","error","message","onOpenChange","index","onStartedChange","newStarted","fromLocalStorage","currentTraderTokenDetails_localSto","newObj","splice","defer","settingsToSend","length","disableKeypressChars","copy_stop","onRemove","toBeRemovedItem","onRefresh","trader","disableRefresh","console","onMinTradeChange","event","formatAndSetTradeStake","onMaxTradeChange","type_trade_stake","target","data","value","format_amount","isNil","match","onUpdateYourSettings","notice","onTokenChange","onKeyDown","keyCode","addToken","some","tokenUserData","Error","openTokenMgmt","click","initConfigWindow","root","html","rv","bind","windows","createBlankWindow","title","resizable","collapsable","minimizable","maximizable","modal","width","copyTrade","cached","get_settings","traderToken","close","unbind","dialog","remove","track","module_id","is_unique","input_el_ids","comma_separated_ids","join","keypress","evt","which","preventDefault","init","$menuLink","moveToTop"],"mappings":"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","file":"copytrade.js","sourcesContent":["import $ from 'jquery';\r\nimport windows from '../windows/windows';\r\nimport rv from '../common/rivetsExtra';\r\nimport _ from 'lodash';\r\nimport html from 'text!./copytrade.html';\r\nimport 'css!./copytrade.css';\r\nimport { trade_types } from '../common/common';\r\nimport '../common/util';\r\nimport liveapi from 'websockets/binary_websockets';\r\nimport validateToken from 'websockets/validateToken';\r\nimport { init as instrumentPromise } from '../instruments/instruments';\r\n\r\n// While using copy trader, this cannot be NULL\r\nconst getLoggedInUserId = () => local_storage.get(\"oauth\")[0].id;\r\n\r\nconst TRADE_TYPES = trade_types;\r\n\r\nconst form_error_messages = {\r\n    INVALID_STAKE_LIMIT: 'Min trade stake should be lower than max trade stake.'.i18n(),\r\n    TOKEN_ALREADY_ADDED: 'Token already added'.i18n(),\r\n    ENTER_VALID_TOKEN: 'Enter a valid trader token'.i18n(),\r\n    REFRESH_FAILED: 'Refresh failed'.i18n(),\r\n};\r\n\r\nconst getStorageName = () => `copyTrade_${getLoggedInUserId()}`;\r\n\r\nconst DEFAULT_TRADE_TYPES = TRADE_TYPES.slice(0, 2).map(m => m.api_code);\r\n\r\nconst defaultCopySettings = (traderApiToken) => ({\r\n  copy_start: traderApiToken,\r\n  min_trade_stake: 10,\r\n  max_trade_stake: 100,\r\n  assets: _.cloneDeep(DEFAULT_ASSETS),\r\n  trade_types: _.cloneDeep(DEFAULT_TRADE_TYPES),\r\n});\r\n\r\nconst defaultTraderDetails = (traderApiToken, loginid) => ({\r\n  open: false,\r\n  started: false,\r\n  disableStart: false,\r\n  loginid,\r\n  yourCopySettings: defaultCopySettings(traderApiToken),\r\n});\r\n\r\nconst validate_min_max_stake = (yourCopySettingsData) => {\r\n  const { min_trade_stake, max_trade_stake } = yourCopySettingsData;\r\n  if (+min_trade_stake > +max_trade_stake) {\r\n    return false;\r\n  }\r\n  return true;\r\n};\r\n\r\nconst updateLocalStorage = _.debounce(scope => {\r\n  const clonedScope = _.cloneDeep(scope);\r\n  delete clonedScope.searchToken.disable;\r\n  local_storage.set(getStorageName(), clonedScope);\r\n}, 50);\r\n\r\nlet GROUPED_INTRUMENTS = null; // For nice display purpose only\r\nlet DEFAULT_ASSETS = null;\r\n//Get instrument list\r\ninstrumentPromise().then(instruments => {\r\n  GROUPED_INTRUMENTS = _.flatten(instruments.map(m => {\r\n    const displayName = m.display_name;\r\n    return m.submarkets.map(mm => ({\r\n      displayName: `${displayName} - ${mm.display_name}`,\r\n      instruments: mm.instruments,\r\n    }));\r\n  }));\r\n  let assets = [];\r\n  instruments.forEach(eGrp => {\r\n    eGrp.submarkets.forEach(eSubGrp => {\r\n      eSubGrp.instruments.forEach(({ symbol, display_name }) => {\r\n        assets.push({\r\n          code: symbol,\r\n          name: display_name,\r\n        });\r\n      });\r\n    });\r\n  });\r\n  state.masterAssetList = assets;\r\n  state.groupedAssets = GROUPED_INTRUMENTS;\r\n  // Randomly add top 2 assets in default list\r\n  DEFAULT_ASSETS = assets.filter(f => f.code === 'R_10').map(m => m.code);\r\n});\r\n\r\nconst refreshTraderStats = (loginid, token, scope) => {\r\n  return new Promise((resolve, reject) => {\r\n    liveapi\r\n      .send({\r\n        copytrading_statistics: 1,\r\n        trader_id: loginid,\r\n      })\r\n      .then((copyStatData) => {\r\n        if (copyStatData.copytrading_statistics) {\r\n          const traderTokenDetails = _.find(scope.traderTokens, f =>\r\n            f.yourCopySettings && f.yourCopySettings.copy_start === token);\r\n          //Check if we already added this trader. If yes, then merge the changes\r\n          if (traderTokenDetails) {\r\n            _.merge(traderTokenDetails.traderStatistics, copyStatData.copytrading_statistics);\r\n          }\r\n          //If not added, then add this along with default yourCopySettings object\r\n          else {\r\n            scope.traderTokens.push(_.merge({\r\n              traderStatistics: copyStatData.copytrading_statistics,\r\n            }, defaultTraderDetails(token, loginid)));\r\n          }\r\n        }\r\n        updateLocalStorage(scope);\r\n        resolve();\r\n      }).catch((e) => {\r\n        reject(e);\r\n      });\r\n  });\r\n};\r\n\r\nlet win = null, win_view = null;\r\n\r\nconst state = {\r\n  masterAssetList: [],\r\n  masterTradeTypeList: _.cloneDeep(TRADE_TYPES),\r\n  groupedAssets: [],\r\n  is_loading: true,\r\n  allowCopy: {\r\n    allow_copiers: 0,\r\n    onAllowCopyChangeCopierCellClick: () => state.onChangeCopytradeSettings(0),\r\n    onAllowCopyChangeTraderCellClick: () => state.onChangeCopytradeSettings(1),\r\n  },\r\n  onChangeCopytradeSettings: _.debounce((allow_copiers) => {\r\n    if (state.allowCopy.allow_copiers === allow_copiers) return;\r\n\r\n    state.is_loading = true;\r\n\r\n    liveapi\r\n      .send({\r\n        set_settings: 1,\r\n        allow_copiers,\r\n      })\r\n      // set_settings api res does not have updated settings\r\n      .then((settings) => {\r\n        state.is_loading = false;\r\n        state.allowCopy.allow_copiers = allow_copiers;\r\n      })\r\n      .catch(e => {\r\n        state.is_loading = false;\r\n        $.growl.error({ message: e.message });\r\n      });\r\n  }, 250),\r\n  onOpenChange: (index) => {\r\n    state.traderTokens[index].open = !state.traderTokens[index].open;\r\n  },\r\n  onStartedChange: (index) => {\r\n    state.traderTokens[index].disableStart = true;\r\n    const newStarted = !state.traderTokens[index].started;\r\n    if (newStarted) {\r\n      //Start copying\r\n      //if started, revert back to last saved changes(in case user changed anything)\r\n      const fromLocalStorage = local_storage.get(getStorageName());\r\n      if (fromLocalStorage) {\r\n        const currentTraderTokenDetails_localSto = fromLocalStorage.traderTokens[index];\r\n        if (currentTraderTokenDetails_localSto) {\r\n          const newObj = {};\r\n          _.merge(newObj, state.traderTokens[index], currentTraderTokenDetails_localSto);\r\n          state.traderTokens.splice(index, 1);\r\n          //Have to apply this trick in order to trigger update of UI using rivetsjs.\r\n          _.defer(() => {\r\n            state.traderTokens.splice(index, 0, newObj);\r\n            const settingsToSend = _.cloneDeep(newObj.yourCopySettings);\r\n            if (!settingsToSend.min_trade_stake) delete settingsToSend.min_trade_stake;\r\n            if (!settingsToSend.max_trade_stake) delete settingsToSend.max_trade_stake;\r\n            if (!settingsToSend.assets || settingsToSend.assets.length <= 0) delete settingsToSend.assets;\r\n            if (!settingsToSend.trade_types || settingsToSend.trade_types.length <= 0) delete settingsToSend.trade_types;\r\n\r\n            liveapi\r\n              .send(settingsToSend)\r\n              .then(() => {\r\n                newObj.disableStart = false;\r\n                newObj.started = true;\r\n                disableKeypressChars('#max_trade_stake', '#min_trade_stake');\r\n                updateLocalStorage(state);\r\n              })\r\n              .catch(e => {\r\n                $.growl.error({ message: e.message });\r\n                newObj.disableStart = false;\r\n                disableKeypressChars('#max_trade_stake', '#min_trade_stake');\r\n                updateLocalStorage(state);\r\n              });\r\n          });\r\n        }\r\n      }\r\n    } else {\r\n      //Stop copying\r\n      liveapi.send({\r\n          copy_stop: state.traderTokens[index].yourCopySettings.copy_start\r\n        })\r\n        .then(() => {\r\n          state.traderTokens[index].disableStart = false;\r\n          state.traderTokens[index].started = false;\r\n          updateLocalStorage(state);\r\n        })\r\n        .catch(e => {\r\n          $.growl.error({ message: e.message });\r\n          state.traderTokens[index].disableStart = false;\r\n          updateLocalStorage(state);\r\n        });\r\n    }\r\n  },\r\n  onRemove: (index) => {\r\n    const toBeRemovedItem = state.traderTokens[index];\r\n    state.traderTokens.splice(index, 1);\r\n    updateLocalStorage(state);\r\n    liveapi.send({\r\n      copy_stop: toBeRemovedItem.yourCopySettings.copy_start\r\n    })\r\n    .catch(e => {});\r\n  },\r\n  onRefresh: (index) => {\r\n    const trader = state.traderTokens[index];\r\n    const loginid = trader.loginid;\r\n    const token = trader.yourCopySettings.copy_start;\r\n    if (loginid && token) {\r\n      trader.disableRefresh = true;\r\n      refreshTraderStats(loginid, token, state)\r\n        .then(() => {\r\n          trader.disableRefresh = false;\r\n        })\r\n        .catch((e) => {\r\n          console.error(e)\r\n          $.growl.error({ message: form_error_messages.REFRESH_FAILED });\r\n          trader.disableRefresh = false;\r\n        });\r\n    }\r\n  },\r\n  onMinTradeChange: (event, scope) => {\r\n    state.formatAndSetTradeStake(event, scope, 'min_trade_stake')\r\n  },\r\n  onMaxTradeChange: (event, scope) => {\r\n    state.formatAndSetTradeStake(event, scope, 'max_trade_stake')\r\n  },\r\n  formatAndSetTradeStake: (event, scope, type_trade_stake) => {\r\n    const index = $(event.target).data('index');\r\n    const value = event.target.value;\r\n    const format_amount = _.isNil(value) ? false : value.match(/0*(\\d+\\.?\\d{0,2})/);\r\n    if (format_amount) {\r\n      scope.traderTokens[index].yourCopySettings[type_trade_stake] = format_amount[1];\r\n    } else {\r\n      scope.traderTokens[index].yourCopySettings[type_trade_stake] = '';\r\n    }\r\n  },\r\n  onUpdateYourSettings: (index) => {\r\n    if (validate_min_max_stake(state.traderTokens[index].yourCopySettings)) {\r\n      updateLocalStorage(state);\r\n      $.growl.notice({ message: 'Updated successfully' });\r\n    } else {\r\n      $.growl.error({ message: form_error_messages.INVALID_STAKE_LIMIT });\r\n    }\r\n  },\r\n  searchToken: {\r\n    token: '',\r\n    onTokenChange: (event, scope) => scope.searchToken.token = event.target.value,\r\n    disable: false,\r\n    onKeyDown: (event, scope) => {\r\n      if (event.keyCode === 13) {\r\n        scope.searchToken.addToken(event, scope);\r\n      }\r\n    },\r\n    addToken: (event, scope) => {\r\n      //If searchToken.token is empty, do nothing\r\n      if (!scope.searchToken.token) {\r\n        $.growl.error({ message: form_error_messages.ENTER_VALID_TOKEN });\r\n        return;\r\n      }\r\n\r\n      //If already added, throw error\r\n      if (_.some(state.traderTokens, f => f.yourCopySettings.copy_start === scope.searchToken.token)) {\r\n        $.growl.error({ message: form_error_messages.TOKEN_ALREADY_ADDED });\r\n        return;\r\n      }\r\n\r\n      scope.searchToken.disable = true;\r\n\r\n      validateToken(scope.searchToken.token)\r\n        .then(tokenUserData => {\r\n          if (!tokenUserData) throw new Error('Invalid token');\r\n          refreshTraderStats(tokenUserData.loginid, scope.searchToken.token, scope)\r\n            .then(() => {\r\n              scope.searchToken.token = '';\r\n              scope.searchToken.disable = false;\r\n            })\r\n            .catch((error) => {\r\n              scope.searchToken.disable = false;\r\n              console.error(error);\r\n              $.growl.error({ message: error.message });\r\n            });\r\n        })\r\n        .catch(error => {\r\n          $.growl.error({ message: error.message });\r\n          scope.searchToken.disable = false;\r\n        });\r\n    },\r\n  },\r\n  traderTokens: [],\r\n  openTokenMgmt: () => $('li.account ul a.token-management').click(),\r\n};\r\n\r\nconst initConfigWindow = () => {\r\n  const root = $(html).i18n();\r\n  win_view = rv.bind(root[0], state);\r\n  win = windows.createBlankWindow(root, {\r\n    title: 'Copy Trading'.i18n(),\r\n    resizable: false,\r\n    collapsable: false,\r\n    minimizable: true,\r\n    maximizable: false,\r\n    modal: false,\r\n    width: 600,\r\n    open: () => {\r\n      //Refresh all token details\r\n      const copyTrade = local_storage.get(getStorageName());\r\n      if (copyTrade) {\r\n        _.merge(state, copyTrade);\r\n        state.traderTokens = _.cloneDeep(state.traderTokens); // This is needed to trigger rivetsjs render\r\n      }\r\n      state.is_loading = true;\r\n\r\n      liveapi\r\n        .cached\r\n        .send({ get_settings: 1 })\r\n        .then((settings) => {\r\n          state.is_loading = false;\r\n          state.allowCopy.allow_copiers = settings.get_settings.allow_copiers;\r\n        })\r\n        .catch((e) => {\r\n          state.is_loading = false;\r\n          $.growl.error({ message: e.message });\r\n        });\r\n      //Refresh locally stored trader statistics\r\n      if (copyTrade) {\r\n        (async function () {\r\n          for (let traderToken of copyTrade.traderTokens) {\r\n            try {\r\n              const loginid = traderToken.loginid;\r\n              const token = traderToken.yourCopySettings.copy_start;\r\n              await refreshTraderStats(loginid, token, state);\r\n            } catch (e) {\r\n              console.error(e);\r\n              $.growl.error({ message: form_error_messages.REFRESH_FAILED });\r\n            }\r\n          }\r\n        })();\r\n      }\r\n    },\r\n    close: () => {\r\n      win_view && win_view.unbind();\r\n      win && win.dialog('destroy').remove();\r\n      win_view = win = null;\r\n      // Clear tokens\r\n      state.traderTokens = [];\r\n    },\r\n    'data-authorized' :'true',\r\n  });\r\n  win.track({\r\n    module_id: 'copyTrade',\r\n    is_unique: true,\r\n    data: null,\r\n  });\r\n  win.dialog( 'open' );\r\n};\r\n\r\nconst disableKeypressChars = (...input_el_ids) => {\r\n  if (input_el_ids.length > 0) {\r\n    const comma_separated_ids = input_el_ids.join(', ');\r\n    $(comma_separated_ids).keypress((evt) => {\r\n      if ((evt.which < 48 || evt.which > 57) && evt.which !== 8 && evt.which !== 46) {\r\n        evt.preventDefault();\r\n      }\r\n    });\r\n  }\r\n};\r\n\r\nexport const init = ($menuLink) => {\r\n  $menuLink.click(() => {\r\n    if (!win) {\r\n      initConfigWindow();\r\n      disableKeypressChars('#max_trade_stake', '#min_trade_stake');\r\n    }\r\n    else { win.moveToTop(); }\r\n  });\r\n};\r\n\r\nexport default { init }\r\n\r\n"]}
{"version":3,"sources":["../../../../src/banners/banners.es6"],"names":["shouldShowBanner","auth","has_mf","account_list","filter","item","landing_company_name","length","has_mlt","has_iom","current_loginId","local_storage","get","loginid","getLoginId","loginids","id","is_mf","is_virtual","init","banner","$","$banner","i18n","nav","find","after","go_to_deriv_el","document","getElementById","href","getDerivUrl","showBanner","liveapi","cached","send","website_status","then","status","ip_country","clients_country","authorize","res","country","landing_company","data","isEuCountry","isEuCountrySelected","classList","remove","add","response","events","on"],"mappings":"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","file":"banners.js","sourcesContent":["import $banner from \"text!./banners.html\";\r\nimport liveapi from \"../websockets/binary_websockets\";\r\nimport \"css!banners/banners.css\";\r\n\r\n\r\nconst shouldShowBanner = (auth) => {\r\n  const has_mf  = auth.account_list.filter( item => item.landing_company_name === 'maltainvest').length;\r\n  const has_mlt = auth.account_list.filter( item => item.landing_company_name === 'malta').length;\r\n  const has_iom = auth.account_list.filter( item => item.landing_company_name === 'iom').length;\r\n  const current_loginId =  local_storage.get('authorize').loginid;\r\n  const getLoginId = loginids().filter( item => item.id === current_loginId);\r\n  const is_mf = getLoginId[0].is_mf;\r\n  const is_virtual = getLoginId[0].is_virtual;\r\n  if (is_mf) {\r\n    return true;\r\n  } else if (is_virtual && has_mf && !has_iom && !has_mlt) {\r\n    return true;\r\n  }\r\n  return false;\r\n};\r\n\r\nexport const init = () => {\r\n  const banner = $($banner).i18n();\r\n  const nav = $(\"body\").find(\"nav\");\r\n  nav.after(banner);\r\n  const go_to_deriv_el = document.getElementById(\"close_banner_btn_iom\");\r\n  go_to_deriv_el.href = getDerivUrl(\"\");\r\n  showBanner();\r\n};\r\n\r\nconst showBanner = () => {\r\n  const banner = document.getElementById(\"close_banner_container\");\r\n  liveapi.cached.send({ website_status: 1 }).then((status) => {\r\n    const ip_country = status.website_status.clients_country;\r\n      if (local_storage.get(\"oauth\")) {\r\n      liveapi.cached.authorize().then((res) => {\r\n        const country = local_storage.get(\"authorize\").country;\r\n        liveapi.send({ landing_company: country }).then((data) => {\r\n          const landing_company = data.landing_company;\r\n          if ((isEuCountry(country, landing_company) && shouldShowBanner(res.authorize))\r\n          || (loginids().length == 1 && isEuCountrySelected(ip_country))) {\r\n            banner.classList.remove(\"invisible\");\r\n          } else {\r\n            banner.classList.add(\"invisible\");\r\n          }\r\n        });\r\n      });\r\n    } else {\r\n      liveapi.send({ landing_company: ip_country }).then((response) => {\r\n        const landing_company = response.landing_company;\r\n        if (isEuCountry(ip_country, landing_company)) {\r\n          banner.classList.remove(\"invisible\");\r\n        } else {\r\n          banner.classList.add(\"invisible\");\r\n        }\r\n      });\r\n    }\r\n  })\r\n  \r\n};\r\n\r\nliveapi.events.on(\"login\", () => {\r\n  showBanner();\r\n});\r\nliveapi.events.on(\"logout\", () => {\r\n  showBanner();\r\n});\r\nliveapi.events.on(\"switch_account\", () => {\r\n  showBanner()\r\n});\r\n\r\nexport default {\r\n  init,\r\n};\r\n"]}
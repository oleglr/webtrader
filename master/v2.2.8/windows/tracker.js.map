{"version":3,"sources":["../../../../src/windows/tracker.es6"],"names":["states","local_storage","get","saved_states","symbols_promise","liveapi","cached","send","trading_times","Date","toISOString","slice","then","data","markets","menu","extractChartableMarkets","symbols","map","flatten","value","instruments","catch","err","console","when_authenticated","Promise","res","is_authenticated","events","on_till","reopen_dialogs","unique_modules","assetIndex","statement","tradingTimes","historicalData","portfolio","profitTable","token","deposit","withdraw","copyTrade","counter","reopen","module_id","position","mode","is_unique","is_authorized","$","click","symbol","instrumentCode","instrument","_","find","i","instrumentName","display_name","length","indexOf","tracker_id","require","chartWindow","isTrackerInitiated","addNewWindow","contracts_for","tradeDialog","dialog","init","template","offset","x","left","y","top","css","trigger","my","at","error","bind","forEach","isArray","d","isObject","save_states","debounce","perv_states","name","set","apply_saved_state","blankWindow","state","saved_state","pos","size","width","height","setTimeout","dialogExtend","track","options","attr","undefined","push","inx","findIndex","elem","splice","on","e","ui","draggable","containment","workspace","reopen_trade_dialogs","trade_dialogs","get_trade_dialogs","cloneDeep","get_unique_dialogs","filter","reopen_unique_dialogs","unique_dialogs","copy","is_empty","ok","values","s","isString"],"mappings":"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","file":"tracker.js","sourcesContent":["/**\r\n * Created by amin on May 27, 2016.\r\n */\r\n\r\nimport windows from \"../windows/windows\";\r\nimport liveapi from \"../websockets/binary_websockets\";\r\nimport _ from \"lodash\";\r\nimport menu from \"../navigation/menu\";\r\n\r\nlet states = local_storage.get('states') || { };\r\nlet saved_states = { };\r\n\r\nconst symbols_promise = liveapi.cached\r\n   .send({ trading_times: new Date().toISOString().slice(0, 10) })\r\n   .then((data) => {\r\n      const markets = menu.extractChartableMarkets(data);\r\n      const symbols = _(markets).map('submarkets').flatten().map('instruments').flatten().map('symbol').value();\r\n      symbols.instruments = _(markets).map('submarkets').flatten().map('instruments').flatten().value();\r\n      return symbols;\r\n   })\r\n   .catch((err) =>{\r\n      console.console(err);\r\n      return [];\r\n   });\r\n\r\nconst when_authenticated = () => {\r\n   return new Promise((res) => {\r\n      if (liveapi.is_authenticated()) {\r\n         return res();\r\n      }\r\n      liveapi.events.on_till('login',() => {\r\n         res();\r\n         return true;\r\n      });\r\n   });\r\n};\r\n\r\nconst reopen_dialogs = (symbols, saved_states) => {\r\n\r\n   const unique_modules = {\r\n      assetIndex: '#nav-menu .assetIndex',\r\n      statement: '#nav-menu .statement',\r\n      tradingTimes: '#nav-menu .tradingTimes',\r\n      historicalData: '#nav-menu .historical-data',\r\n      portfolio: '#nav-menu .portfolio',\r\n      profitTable: '#nav-menu .profitTable',\r\n      token: '#nav-menu .token-management',\r\n      deposit: '#nav-menu .deposit',\r\n      withdraw: '#nav-menu .withdraw',\r\n      copyTrade: '#nav-menu .copytrade',\r\n   };\r\n\r\n   let counter = 0;\r\n   const reopen = (data, module_id) => {\r\n      if(data.position.mode === 'closed') return;\r\n\r\n      if(data.is_unique) {\r\n         if(data.is_authorized) {\r\n            when_authenticated().then(() => {\r\n               $(unique_modules[module_id]).click();\r\n               return true; // unsubscribe from login event\r\n            });\r\n         }\r\n         else {\r\n            $(unique_modules[module_id]).click();\r\n         }\r\n      }\r\n      else if(module_id === 'chartWindow') {\r\n         const symbol = data.data.instrumentCode;\r\n         const instrument = _.find(symbols.instruments, (i) => { return i.symbol==symbol; });\r\n         data.data.instrumentName = instrument.display_name;\r\n         if(symbols.length > 0 && symbols.indexOf(symbol) === -1) {\r\n            /* Since we get the list of ins from trading_times API,\r\n             * backend/quant might change the list of instruments they are offering.\r\n             * We just need to make sure that those charts are not getting restored. */\r\n            return ;\r\n         }\r\n         data.data.tracker_id = ++counter;\r\n         require(['charts/chartWindow'],(chartWindow) => {\r\n            data.data.isTrackerInitiated = true;\r\n            chartWindow.addNewWindow(data.data);\r\n         });\r\n      }\r\n      else if (module_id === 'tradeDialog') {\r\n            when_authenticated().then(() => {\r\n                  data.data.tracker_id = ++counter;\r\n                  liveapi\r\n                  .send({contracts_for: data.data.symbol.symbol})\r\n                  .then((res) => {\r\n                        require(['trade/tradeDialog'], (tradeDialog) => {\r\n                        const dialog = tradeDialog.init(data.data.symbol, res.contracts_for, data.data.template, true/*isTrackerInitiated*/);\r\n                        if(data.position.offset) {\r\n                              const x = data.position.offset.left;\r\n                              const y = data.position.offset.top;\r\n                              dialog.dialog('widget').css({\r\n                              left: x + 'px',\r\n                              top: y + 'px'\r\n                              });\r\n                              dialog.trigger('animated');\r\n                              /* update dialog option.position */\r\n                              dialog.dialog(\"option\", \"position\", { my: x, at: y });\r\n                        }\r\n                        });\r\n                  }).catch(console.error.bind(console));\r\n                  return true; // unsubscribe from login event\r\n            });\r\n      }\r\n      else {\r\n         console.error('unknown module_id ' + module_id);\r\n      }\r\n   };\r\n   _.forEach(saved_states,(data, module_id) => {\r\n      if(_.isArray(data))\r\n         data.forEach((d) => reopen(d, module_id))\r\n      else if(_.isObject(data))\r\n         reopen(data, module_id);\r\n   });\r\n}\r\n\r\n// /* avoid too many writes to local storage */\r\nconst save_states = _.debounce(() => {\r\n   if (liveapi.is_authenticated()) {\r\n      const perv_states = local_storage.get('states');\r\n      states.name = (perv_states && perv_states.name) || states.name;\r\n      local_storage.set('states', states)\r\n   }\r\n}, 50);\r\n\r\nconst apply_saved_state = (dialog, blankWindow, state, saved_state) => {\r\n   const pos = saved_state.position;\r\n\r\n   pos.size && blankWindow.dialog('option', 'width', pos.size.width);\r\n   pos.size && blankWindow.dialog('option', 'height', pos.size.height);\r\n   state.position.size = pos.size;\r\n   state.position.mode = pos.mode;\r\n\r\n   if(pos.mode === 'maximized')\r\n      setTimeout(() => {\r\n         blankWindow.dialogExtend('maximize');\r\n         blankWindow.dialog('moveToTop');\r\n      }, 10);\r\n   else if(pos.mode === 'minimized')\r\n      blankWindow.dialogExtend('minimize');\r\n\r\n   if(pos.offset) {\r\n      dialog.css({\r\n         left: pos.offset.left + 'px',\r\n         top: pos.offset.top + 'px'\r\n      });\r\n      state.position.offset = pos.offset;\r\n   }\r\n\r\n   save_states();\r\n}\r\n\r\n/* options: {\r\n *    module_id: 'statement/statement'  // require js module id\r\n *    is_unique: true/false // is this dialog instance unique or not,\r\n *    data: { } // arbitary data object for this dialog\r\n * }\r\n * blankWindow // dialog returned from windows.createBlankWindow()\r\n *\r\n * returns: a function that can be used to update the data\r\n */\r\nexport const track = (options, blankWindow) => {\r\n   const dialog = blankWindow.dialog('widget');\r\n   let saved_state = null;\r\n   const state = {\r\n      module_id: options.module_id,\r\n      is_unique: options.is_unique,\r\n      is_authorized: blankWindow.attr('data-authorized') === 'true',\r\n      data: options.data,\r\n      position: {\r\n         size: { width: blankWindow.dialog('option', 'width'), height: blankWindow.dialog('option', 'height') },\r\n         offset: undefined,\r\n         mode: 'normal'\r\n      }\r\n   };\r\n   if(options.is_unique){\r\n      states[options.module_id] = state;\r\n      saved_state = saved_states[options.module_id];\r\n      if(saved_state){\r\n         if(saved_state.position.mode === 'closed')\r\n            saved_state = null;\r\n         delete saved_states[options.module_id];\r\n      }\r\n   }\r\n   else {\r\n      states[options.module_id] = states[options.module_id] || [];\r\n      states[options.module_id].push(state);\r\n\r\n      if(saved_states[options.module_id] && state.data.tracker_id !== undefined) {\r\n         const inx = _.findIndex(\r\n            saved_states[options.module_id],\r\n            (elem) => elem.data.tracker_id === state.data.tracker_id\r\n         );\r\n         if(inx !== -1) {\r\n            saved_state = saved_states[options.module_id][inx];\r\n            saved_states[options.module_id].splice(inx, 1);\r\n            if(saved_state.position.mode === 'closed')\r\n               saved_state = null;\r\n         }\r\n      }\r\n   }\r\n   save_states();\r\n   dialog.on('dragstop',() => {\r\n      state.position.offset = dialog.offset();\r\n      save_states();\r\n   });\r\n   dialog.on('animated',() => {\r\n      state.position.offset = dialog.offset();\r\n      save_states();\r\n   });\r\n   dialog.on('resizestop',(e, ui) => {\r\n      state.position.size = ui.size;\r\n      state.position.offset = dialog.offset();\r\n      save_states();\r\n   });\r\n   blankWindow.on('dialogextendminimize',() => {\r\n      state.position.mode = 'minimized';\r\n      save_states();\r\n   });\r\n   blankWindow.on('dialogextendmaximize',() => {\r\n      state.position.mode = 'maximized';\r\n      save_states();\r\n   });\r\n   blankWindow.on('dialogextendrestore',() => {\r\n      dialog.draggable({ containment: false })\r\n      state.position.offset = dialog.offset();\r\n      state.position.mode = 'normal';\r\n      save_states();\r\n   });\r\n   blankWindow.on('dialogdestroy',() => {\r\n      if(state.is_unique){\r\n         delete states[state.module_id];\r\n      }\r\n      else {\r\n         if(states[state.module_id]) { /* if not already cleared by switching between accounts */\r\n            const inx = states[state.module_id].indexOf(state);\r\n            if(states[state.module_id].length == 1)\r\n               delete states[state.module_id];\r\n            else\r\n               states[state.module_id].splice(inx, 1);\r\n         }\r\n      }\r\n      save_states();\r\n   });\r\n   blankWindow.on('dialogclose',() => {\r\n      state.position.mode = 'closed';\r\n      save_states();\r\n   });\r\n   blankWindow.on('dialogopen',() => {\r\n      state.position.offset = dialog.offset();\r\n      state.position.mode = 'normal';\r\n      save_states();\r\n\r\n      if(saved_state){\r\n         apply_saved_state(dialog, blankWindow, state, saved_state);\r\n         saved_state = null;\r\n      }\r\n   });\r\n\r\n\r\n   return (data) => {\r\n      state.data = data;\r\n      save_states();\r\n   };\r\n}\r\n\r\nexport const reopen = (workspace = null) => {\r\n   if(workspace) {\r\n      states = workspace;\r\n   }\r\n   symbols_promise.then((symbols) => {\r\n      saved_states = states;\r\n      states = { };\r\n      save_states();\r\n      reopen_dialogs(symbols, saved_states);\r\n   });\r\n};\r\n\r\n/* used in case of connection drops in binary_websockets onclose() function */\r\nexport const reopen_trade_dialogs = (trade_dialogs) => {\r\n   symbols_promise.then((symbols) => {\r\n      reopen_dialogs(symbols, {tradeDialog: trade_dialogs});\r\n   });\r\n};\r\n\r\nexport const get_trade_dialogs = () => _.cloneDeep(states.tradeDialog || []);\r\n\r\nexport const get_unique_dialogs = () => _.filter(states, {is_unique: true});\r\n\r\nexport const reopen_unique_dialogs = (unique_dialogs) => {\r\n      const copy = {};\r\n      _.forEach(unique_dialogs, data => {\r\n            copy[data.module_id] = copy[data.module_id] || [];\r\n            data.position.mode = 'normal';\r\n            copy[data.module_id].push(data);\r\n      });\r\n      reopen_dialogs(null, copy);\r\n} \r\n\r\nexport const is_empty = () => {\r\n   const ok = _.values(states).filter(\r\n      (s) => !_.isString(s) && (_.isArray(s) || s.position.mode !== 'closed')\r\n   );\r\n   return ok.length === 0;\r\n}\r\n\r\nexport default {\r\n   track,\r\n   reopen,\r\n   reopen_trade_dialogs,\r\n   get_trade_dialogs,\r\n   is_empty,\r\n   get_unique_dialogs,\r\n   reopen_unique_dialogs\r\n}\r\n"]}
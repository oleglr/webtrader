{"version":3,"sources":["../../../../src/trade/tradeMenu.es6"],"names":["show_error","err","$","growl","error","message","console","get_active_symbol","landing_company","country","liveapi","send","active_symbols","then","data","markets","_","groupBy","map","symbols","sym","head","market","name","display_name","market_display_name","submarkets","submarket","submarket_display_name","instruments","symbol","is_disabled","is_trading_suspended","exchange_is_open","pip","every","value","trade","find","menu","refreshMenu","contracts_for","res","require","tradeDialog","init","catch","refresh_active_symbols","local_storage","get","cached","authorize","events","on"],"mappings":"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","file":"tradeMenu.js","sourcesContent":["ï»¿import $ from 'jquery';\r\nimport liveapi from '../websockets/binary_websockets';\r\nimport menu from '../navigation/menu';\r\nimport { getSortedMarketSubmarkets } from '../common/marketUtils';\r\nimport \"jquery-growl\";\r\n\r\nconst show_error = (err) => {\r\n   $.growl.error({ message: err.message });\r\n   console.error(err);\r\n};\r\n\r\nconst get_active_symbol = (landing_company, country) => {\r\n   liveapi\r\n      .send({ active_symbols: 'brief' })\r\n      .then((data) => {\r\n         /* clean up the data! */\r\n         const active_symbols = data.active_symbols;\r\n         let markets = _(active_symbols).groupBy('market').map((symbols) => {\r\n            const active_symbols = symbols;\r\n            const sym = _.head(active_symbols);\r\n            const market = { name: sym.market, display_name: sym.market_display_name };\r\n            market.submarkets = _(active_symbols).groupBy('submarket').map((symbols) => {\r\n               const sym = _.head(symbols);\r\n               const submarket = { name: sym.submarket, display_name: sym.submarket_display_name };\r\n               submarket.instruments = _.map(symbols, (sym) => ({\r\n                  symbol: sym.symbol,\r\n                  display_name: sym.display_name,\r\n                  is_disabled: sym.is_trading_suspended || !sym.exchange_is_open,\r\n                  pip: sym.pip\r\n               })\r\n               );\r\n               submarket.is_disabled = _.every(submarket.instruments, 'is_disabled');\r\n               return submarket;\r\n            }).value();\r\n            market.is_disabled = _.every(market.submarkets, 'is_disabled');\r\n            return market;\r\n         }).value();\r\n         markets = getSortedMarketSubmarkets(markets);        \r\n         const trade = $(\"#nav-menu\").find(\".trade\");\r\n         menu.refreshMenu(trade, markets, (symbol, display_name, pip) => {\r\n            liveapi\r\n               .send({ contracts_for: symbol })\r\n               .then((res) => {\r\n                  require(['trade/tradeDialog'],\r\n                     (tradeDialog) => tradeDialog.init({ symbol, display_name, pip }, res.contracts_for)\r\n                  );\r\n               }).catch(show_error);\r\n         });\r\n      })\r\n      .catch(show_error);\r\n}\r\n\r\nconst refresh_active_symbols = () => {\r\n   if (local_storage.get('oauth')) {\r\n      liveapi\r\n         .cached\r\n         .authorize()\r\n         .then(() => {\r\n            const country = local_storage.get('authorize').country;\r\n            liveapi\r\n            .cached\r\n            .send({ landing_company: country })\r\n            .then((data) => {\r\n               const landing_company = data.landing_company\r\n               get_active_symbol(landing_company, country);\r\n            });\r\n         })\r\n   } else{\r\n      get_active_symbol();\r\n   }\r\n}\r\n\r\nexport const init = () => {\r\n   require(['trade/tradeDialog']); // Trigger loading of tradeDialog\r\n   refresh_active_symbols();\r\n   require(['websockets/binary_websockets'], (liveapi) => {\r\n      liveapi.events.on('login', refresh_active_symbols);\r\n      liveapi.events.on('logout', refresh_active_symbols);\r\n   });\r\n}\r\n\r\nexport default { init };\r\n"]}
{"version":3,"sources":["../../../../src/trade/tradeDialog.es6"],"names":["init","require","replacer","field_name","value","obj","debounce","rv","formatters","apply_fixes","available","filter","each","_","sortBy","row","rank","find","val","key","i18n","contract_category_display","contract_display","trading_times_for","yyyy_mm_dd","symbol","liveapi","cached","send","trading_times","then","data","times","open","close","markets","forEach","market","submarkets","sub","symbols","sym","catch","err","console","error","get_current_template","state","name","template","categories_value","categories","categoriy_displays_selected","category_displays","selected","date_start_value","date_start","digits_value","digits","duration_value","duration","duration_count_value","duration_count","duration_unit_value","duration_unit","expiry_value_hour","date_expiry","value_hour","expiry_value_date","value_date","expiry_value","barriers_barrier_count","barriers","barrier_count","barriers_barrier","barrier","barriers_high_barrier","high_barrier","barriers_low_barrier","low_barrier","basis_value","basis","currency_value","currency","basis_amount","amount","spreads_amount_per_point","spreads","amount_per_point","spreads_stop_type","stop_type","spreads_stop_loss","stop_loss","spreads_stop_profit","stop_profit","set_current_template","tpl","warn","msg","$","growl","warning","message","array","contract_category","defer","type","sentiment","visible","some","is_today","moment","utc","isAfter","validateHour","hour","today_times","selected_date_unix","formatted","unix","format","now","close_hour","open_hour","validateMinute","minute","close_minute","open_minute","hasIntradayUnit","duration_unit_array","indexOf","unit","init_state","root","dialog","contracts_for_spot","ranges","min","max","text","hour_minute","onHourShow","onMinuteShow","disabled","min_date","paddingTop","paddings","is_offset_barrier","is_offset_low_barrier","is_offset_high_barrier","perv_barrier","was_perv_barrier_daily","perv_high_barrier","was_perv_high_barrier_daily","perv_low_barrier","was_perv_low_barrier_daily","barrier_live","tick","quote","high_barrier_live","low_barrier_live","decimals","currencyFractionalDigits","limit","spread","spot","spot_time","deposit_","epoch","perv_quote","down","ans","ticks","loading","proposal","symbol_name","display_name","last_promise","id","ask_price","display_value","payout","multiplier","pip","getSymbolPipValue","netprofit_","contract_type","Lookback","isLookback","formatPrice","payout_","formula","return_","toFixed","purchase","tooltips","my","at","collision","barrier_p","update_currency","is_authenticated","payout_currencies","hide","e","target","closest","length","toggle","update_times","range","head","add","update","category","isInOut","v","check","el","test","toLowerCase","map","uniq","y","x","category_object","push","onclick","attr","forward_starting_market","assign","spot_starting_options","start_dates","forward_starting_options","available_day","date","unshift","selected_date","options","setDateStartHourMinute","date_start_formatted","date_start_with_selected_hour_minute","now_hour_minute","date_or_hour","is_duration","is_daily_contracts","onchange","includes","start_type","durations","r","min_contract_duration","max_contract_duration","expiry_type","d","daily","replace","min_unit","last","max_unit","Math","sort_dict","sort","r1","r2","try_to_keep_value","subcat","match","differ","under","over","update_barrier","new_barrier","sign","is_daily","def_barrier","result","update_limit","payout_limit","request","times_to_retry","required_err_code_for_retry","response","i","lookback_request","makeLookbackRequest","code","subscribeProposalHandler","subscribe","format_amount","isNil","toString","input","add_barriers_to_request","set_is_barrier_offset","forget","new_proposal_promise","update_track","get_template","barrier2","is_offset","startsWith","categories_with_tick_chart","show","div","appendTo","css","left","remove","extra","category_display","show_tick_chart","tick_count","tradeConf","buy","price","contract_id","transaction_id","proposal_open_contract","invalidate","SUPPORTED_CONTRACT_TYPES","f","contract_object","tick_stream_alive","events","on","shift","longcode","contracts_for","saved_template","isTrackerInitiated","html","windows","createBlankWindow","title","resizable","collapsable","minimizable","maximizable","width","relativePosition","chartingRequestMap","unregister","view","unbind","destroy","track","module_id","is_unique","keyFor","has_digits","register","style","delay","bind","undefined","set_template","hide_template_menu","tradeTemplateManager","keypress","evt","which","preventDefault"],"mappings":"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","file":"tradeDialog.js","sourcesContent":["import _ from 'lodash';\r\nimport $ from 'jquery';\r\nimport moment from 'moment';\r\nimport windows from 'windows/windows';\r\nimport rv from 'common/rivetsExtra';\r\nimport { SUPPORTED_CONTRACT_TYPES } from 'common/common';\r\nimport liveapi from 'websockets/binary_websockets';\r\nimport chartingRequestMap from 'charts/chartingRequestMap';\r\nimport html from 'text!trade/tradeDialog.html';\r\nimport 'css!trade/tradeDialog.css';\r\nimport 'timepicker';\r\nimport 'jquery-ui';\r\nimport 'common/util';\r\nimport Lookback from './lookback';\r\n\r\nrequire(['trade/tradeConf']); /* trigger async loading of trade Confirmation */\r\nvar replacer = function (field_name, value) { return function (obj) { obj[field_name] = value; return obj; }; };\r\nvar debounce = rv.formatters.debounce;\r\n\r\nfunction apply_fixes(available){\r\n    /* fix for server side api, not seperating higher/lower from rise/fall in up/down category */\r\n    _(available).filter({\r\n      'contract_category': 'callput',\r\n      'barrier_category' : 'euro_atm',\r\n      'barriers': 0,\r\n      'sentiment': 'up'\r\n    }).each(replacer('contract_display', 'rise'));\r\n\r\n    _(available).filter({\r\n      'contract_category': 'callput',\r\n      'barrier_category': 'euro_atm',\r\n      'barriers': 0,\r\n      'sentiment': 'down'\r\n    }).each(replacer('contract_display','fall'));\r\n    /* fix for server side api, returning two different contract_category_displays for In/Out */\r\n    _(available).filter(['contract_category', 'endsinout']).each(replacer('contract_category_display', 'In/Out'));\r\n    _(available).filter(['contract_category', 'staysinout']).each(replacer('contract_category_display', 'In/Out'));\r\n    /* fix for websocket having a useless barrier value for digits */\r\n    _(available).filter(['contract_category', 'digits']).each(replacer('barriers', 0));\r\n    /* fix for contract_display text in In/Out menue */\r\n    _(available).filter({\"contract_type\": \"EXPIRYMISS\"}).each(replacer('contract_display', 'ends outside'));\r\n    _(available).filter({\"contract_type\": \"EXPIRYRANGE\"}).each(replacer('contract_display', 'ends between'));\r\n    _(available).filter({\"contract_type\": \"RANGE\"}).each(replacer('contract_display', 'stays between'));\r\n    _(available).filter({\"contract_type\": \"UPORDOWN\"}).each(replacer('contract_display', 'goes outside'));\r\n    _(available).filter({\"contract_type\": \"ONETOUCH\"}).each(replacer('contract_display', 'touch'));\r\n    _(available).filter({\"contract_type\": \"NOTOUCH\"}).each(replacer('contract_display', 'no touch'));\r\n\r\n    /* sort the items in the array according to the way we want to show them */\r\n    available = _.sortBy(available,function(row){\r\n      var rank = _.find({ 'Up/Down': 1, 'Touch/No Touch':2, 'In/Out': 3, 'Digits': 4, 'Asians': 5, 'Spreads': 6 },\r\n        (val, key) => {\r\n          if(key.i18n() == row.contract_category_display || key == row.contract_category_display){\r\n            return val;\r\n          }\r\n        }\r\n      );\r\n      if(rank === 4) { /* Digits */\r\n        rank = {'odd': 4, 'even' : 4.5}[row.contract_display] || 3.5;\r\n      }\r\n      return rank\r\n    });\r\n\r\n    return available;\r\n}\r\n\r\n/* get open and close time for a symbol trading_times */\r\nfunction trading_times_for(yyyy_mm_dd, symbol) {\r\n    return liveapi.cached\r\n           .send({trading_times: yyyy_mm_dd})\r\n           .then(function(data){\r\n              var times = { open : '--', close: '--'};\r\n              data.trading_times.markets.forEach(function(market){\r\n                  market.submarkets.forEach(function(sub){\r\n                    sub.symbols.forEach(function(sym){\r\n                      if(sym.symbol === symbol) {\r\n                        times = {open: sym.times.open[0], close: sym.times.close[0]};\r\n                      }\r\n                    });\r\n                  });\r\n              });\r\n              return times;\r\n           })\r\n           .catch(function(err){\r\n             console.error(err);\r\n             return { open : '--', close: '--'};\r\n           });\r\n}\r\n\r\n/* return the current state of dialog as a template */\r\nfunction get_current_template(state) {\r\n  return {\r\n    name: state.template.name,\r\n    categories_value: state.categories.value,\r\n    categoriy_displays_selected: state.category_displays.selected,\r\n    date_start_value: state.date_start.value,\r\n    digits_value: state.digits.value,\r\n    duration_value: state.duration.value,\r\n    duration_count_value: state.duration_count.value,\r\n    duration_unit_value: state.duration_unit.value,\r\n    expiry_value_hour: state.date_expiry.value_hour,\r\n    expiry_value_date: state.date_expiry.value_date,\r\n    expiry_value: state.date_expiry.value,\r\n    barriers_barrier_count: state.barriers.barrier_count,\r\n    barriers_barrier: state.barriers.barrier,\r\n    barriers_high_barrier: state.barriers.high_barrier,\r\n    barriers_low_barrier: state.barriers.low_barrier,\r\n    basis_value: state.basis.value,\r\n    currency_value: state.currency.value,\r\n    basis_amount: state.basis.amount,\r\n    spreads_amount_per_point: state.spreads.amount_per_point,\r\n    spreads_stop_type: state.spreads.stop_type,\r\n    spreads_stop_loss: state.spreads.stop_loss,\r\n    spreads_stop_profit: state.spreads.stop_profit\r\n  };\r\n};\r\n\r\nfunction set_current_template(state, tpl) {\r\n  state.template.name = tpl.name;\r\n  var warn = function(msg) { $.growl.warning({ message: msg || 'Template applied partially.'.i18n() }); }\r\n  if(!_.find(state.categories.array, tpl.categories_value)) {\r\n    $.growl.error({ message: 'Template is not applicable.'.i18n() });\r\n    return;\r\n  }\r\n  state.categories.selected = tpl.categories_value.contract_category;\r\n  _.defer(function() {\r\n    if(!_.find(state.category_displays.array,\r\n      type => type.name===tpl.categoriy_displays_selected.name && type.sentiment===tpl.categoriy_displays_selected.sentiment)) {\r\n      warn();\r\n      return;\r\n    }\r\n    state.category_displays.selected = tpl.categoriy_displays_selected;\r\n    _.defer(function() {\r\n      if(state.date_start.visible) {\r\n        _.defer(function() {\r\n          if (state.date_start.value !== 'now' && _.some(state.date_start.array, {value: tpl.date_start_value*1})) {\r\n            state.date_start.value = tpl.date_start_value*1;\r\n          } else {\r\n            state.date_start.value = 'now';\r\n          }\r\n        });\r\n      }\r\n      if(state.digits.visible) {\r\n        state.digits.value = tpl.digits_value;\r\n      }\r\n      if(state.categories.value.contract_category !== 'spreads') { /* <----- duration */\r\n        state.duration.value = tpl.duration_value;\r\n        if(state.duration.value === 'Duration' ) {\r\n          _.defer(function() {\r\n            state.duration_unit.value = tpl.duration_unit_value;\r\n            _.defer(function() {\r\n              state.duration_count.value = tpl.duration_count_value;\r\n            });\r\n          });\r\n        }\r\n        if(state.duration.value === 'End Time') {\r\n          _.defer(function() {\r\n              state.date_expiry.value_date = tpl.expiry_value_date;\r\n              var is_today = !moment.utc(state.date_expiry.value_date).isAfter(moment.utc(),'day');\r\n              if(is_today) {\r\n                _.defer(function() {\r\n                  state.date_expiry.value_hour = tpl.expiry_value_hour;\r\n                });\r\n              }\r\n          });\r\n        }\r\n      } /* <---- duration */\r\n\r\n      state.barriers.barrier_count = tpl.barriers_barrier_count;\r\n      if(state.barriers.barrier_count === 1) {\r\n        _.defer(function() {\r\n          state.barriers.barrier = tpl.barriers_barrier;\r\n        });\r\n      }\r\n      if(state.barriers.barrier_count === 2) {\r\n        _.defer(function() {\r\n          state.barriers.high_barrier = tpl.barriers_high_barrier;\r\n          state.barriers.low_barrier = tpl.barriers_low_barrier;\r\n        });\r\n      }\r\n      /* <---- barriers */\r\n\r\n      if(state.categories.value.contract_category !== 'spreads') {\r\n        _.defer(function() {\r\n          state.basis.value = tpl.basis_value;\r\n          state.currency.value = state.currency.value ? state.currency.value : tpl.currency_value;\r\n          state.basis.amount = tpl.basis_amount;\r\n        });\r\n      } /* <----- basis, currency */\r\n\r\n      if(state.categories.value.contract_category === 'spreads') {\r\n          state.currency.value = tpl.currency_value;\r\n          state.spreads.amount_per_point = tpl.spreads_amount_per_point;\r\n          state.spreads.stop_type = tpl.spreads_stop_type;\r\n          state.spreads.stop_loss = tpl.spreads_stop_loss;\r\n          state.spreads.stop_profit = tpl.spreads_stop_profit;\r\n\r\n      } /* <---- Spreads */\r\n    });\r\n  })\r\n}\r\n\r\nfunction validateHour({ hour, today_times, selected_date_unix }) {\r\n  const formatted = moment.unix(+selected_date_unix).format('YYYY-MM-DD');\r\n  const is_today = !moment.utc(formatted).isAfter(moment.utc(),'day');\r\n  if (!is_today) return true;\r\n\r\n  const { close, open } = today_times;\r\n  if (open === '--') return true;\r\n\r\n  const now        = moment.utc();\r\n  const close_hour = moment(close, 'HH:mm:ss').hour();\r\n  let   open_hour  = moment(open, 'HH:mm:ss').hour();\r\n\r\n  if (now.hour() >= open_hour && now.hour() <= close_hour) {\r\n    open_hour = now.hour();\r\n  }\r\n\r\n  return (hour >= open_hour && hour <= close_hour) ||\r\n         (hour <= close_hour && close_hour <= open_hour) ||\r\n         (hour >= open_hour && open_hour >= close_hour);\r\n}\r\n\r\nfunction validateMinute({ hour, minute, today_times, selected_date_unix }) {\r\n  const formatted = moment.unix(+selected_date_unix).format('YYYY-MM-DD');\r\n  const is_today = !moment.utc(formatted).isAfter(moment.utc(),'day');\r\n  if (!is_today) return true;\r\n\r\n  const { close, open } = today_times;\r\n  if (open === '--') return true;\r\n\r\n  const now          = moment.utc(),\r\n        close_hour   = moment(close, 'HH:mm:ss').hour(),\r\n        close_minute = moment(close, 'HH:mm:ss').minute();\r\n  let open_hour      = moment(open, 'HH:mm:ss').hour(),\r\n      open_minute    = moment(open, 'HH:mm:ss').minute();\r\n\r\n  if (now.hour() >= open_hour && now.hour() <= close_hour) {\r\n    open_hour =  now.hour();\r\n    open_minute = now.minute();\r\n  }\r\n  if (open_hour === hour) return minute >= open_minute;\r\n  if (close_hour === hour) return minute <= close_minute;\r\n\r\n  return (hour > open_hour && hour < close_hour) || hour < close_hour || hour > open_hour;\r\n}\r\n\r\nfunction hasIntradayUnit(duration_unit_array) {\r\n  return duration_unit_array.some(unit => ['ticks', 'seconds', 'minutes', 'hours'].indexOf(unit) !== -1);\r\n}\r\n\r\nfunction init_state(available,root, dialog, symbol, contracts_for_spot) {\r\n  var state = {\r\n    duration: {\r\n      array: ['Duration', 'End Time'],\r\n      value: 'Duration',\r\n    },\r\n    duration_unit: {\r\n      array: [''],\r\n      ranges: [{min: 1, max:365}],\r\n      value: '',\r\n    },\r\n    duration_count: {\r\n      value: 1,\r\n      min: 1,\r\n      max: 365\r\n    },\r\n    date_start: {\r\n      value: 'now', /* epoch value if selected */\r\n      array: [{ text: 'Now', value: 'now' } ],\r\n      visible: false,\r\n      hour_minute: '',\r\n      today_times: { open: '--', close: '--' }, /* trading times for today */\r\n      onHourShow: function(hour) { /* for timepicker */\r\n        return validateHour({\r\n          hour,\r\n          today_times: state.date_start.today_times,\r\n          selected_date_unix: state.date_start.value,\r\n        });\r\n      },\r\n      onMinuteShow: function(hour, minute) {\r\n        return validateMinute({\r\n          hour,\r\n          minute,\r\n          today_times: state.date_start.today_times,\r\n          selected_date_unix: state.date_start.value,\r\n        });\r\n      }\r\n    },\r\n    date_expiry: {\r\n      value_date: moment.utc().format('YYYY-MM-DD'), /* today utc in yyyy-mm-dd format */\r\n      value_hour: moment.utc().format('HH:mm'), /* now utc in hh:mm format */\r\n      value: 0,    /* epoch value of date+hour */\r\n      today_times: { open: '--', close: '--', disabled: false }, /* trading times for today */\r\n      min_date: 0,\r\n      onHourShow: function(hour) { /* for timepicker */\r\n        return validateHour({\r\n          hour,\r\n          today_times: state.date_expiry.today_times,\r\n          selected_date_unix: state.date_expiry.value,\r\n        });\r\n      },\r\n      onMinuteShow: function(hour, minute) {\r\n        return validateMinute({\r\n          hour,\r\n          minute,\r\n          today_times: state.date_expiry.today_times,\r\n          selected_date_unix: state.date_expiry.value,\r\n        });\r\n      }\r\n    },\r\n    categories: {\r\n      array: [],\r\n      value: '',\r\n      paddingTop: function() {\r\n        var paddings = { \"asian\" : '26px', \"callput\" : '8px', \"digits\" : '14px', \"endsinout\" : '4px', \"staysinout\" : '4px', \"touchnotouch\" : '12px' , \"lookback\":'26px', \"callputequal\" : '8px'};\r\n        return paddings[state.categories.value.contract_category] || '3px';\r\n      }\r\n    },\r\n    category_displays: {\r\n      array: [],\r\n      selected: ''\r\n    },\r\n    barriers: {\r\n      is_offset_barrier: false,\r\n      is_offset_low_barrier: false,\r\n      is_offset_high_barrier: false,\r\n      barrier_count: 0,\r\n      barrier : '',\r\n      perv_barrier: '', // previous barrier value for intraday and tick contracts.\r\n      was_perv_barrier_daily: false, // was the perv barrier a daily one?\r\n      high_barrier: '',\r\n      perv_high_barrier: '',\r\n      was_perv_high_barrier_daily: false,\r\n      low_barrier: '',\r\n      perv_low_barrier: '',\r\n      was_perv_low_barrier_daily: false,\r\n      barrier_live: function() { return this.barrier * 1 + state.tick.quote * 1; },\r\n      high_barrier_live: function() { return this.high_barrier * 1 + state.tick.quote * 1; },\r\n      low_barrier_live: function() { return this.low_barrier * 1 + state.tick.quote * 1; },\r\n    },\r\n    digits: {\r\n      array: ['0', '1','2','3','4','5','6','7','8','9'],\r\n      value: '0',\r\n      visible: false,\r\n      text: 'Last Digit Prediction'.i18n()\r\n    },\r\n    currency: {\r\n      array: ['USD'],\r\n      value: 'USD',\r\n      decimals: currencyFractionalDigits(),\r\n    },\r\n    basis: {\r\n      array: ['Payout', 'Stake'],\r\n      value: 'payout',\r\n      amount: currencyFractionalDigits() === 8 ? 0.10000000 : 10,\r\n      limit: null,\r\n    },\r\n    spreads: {\r\n      amount_per_point: 1,\r\n      stop_type: 'point', /* could be 'point' or 'dollar' */\r\n      stop_loss: (_.find(available, 'stop_loss') || { stop_loss: 10}).stop_loss,\r\n      stop_profit: (_.find(available, 'stop_profit') || { stop_profit: 10}).stop_profit,\r\n      /* updated from #proposal websocket api */\r\n      spread: 0.0,\r\n      spot: '0.0',\r\n      spot_time: '0',\r\n      deposit_: function(){\r\n        if(this.stop_type === 'point')\r\n          return this.stop_loss * this.amount_per_point;\r\n        else // 'dollar'\r\n          return this.stop_loss;\r\n      }\r\n    },\r\n    tick: {\r\n      epoch: '0',\r\n      quote: contracts_for_spot,\r\n      perv_quote: '0',\r\n      down: function(){\r\n        var ans= this.quote*1 < this.perv_quote*1;\r\n        return ans;\r\n      }\r\n    },\r\n    ticks: {\r\n      array: [], /* ticks for sparkline chart */\r\n      loading: true,\r\n    },\r\n    proposal: {\r\n      symbol: symbol.symbol,\r\n      symbol_name: symbol.display_name,\r\n      last_promise: null,\r\n      id: '', /* id of last proposal request sent */\r\n      ask_price: \"0.0\",\r\n      date_start: 0,\r\n      display_value: \"0.0\",\r\n      message: 'Loading ...'.i18n(), /* longcode */\r\n      payout: 0,\r\n      spot: \"0.0\",\r\n      spot_time: \"0\",\r\n      multiplier: \"0\",\r\n      error: '',\r\n      loading: true, /* the proposal request state */\r\n      pip: getSymbolPipValue(symbol.symbol),\r\n      /* computed properties */\r\n      netprofit_: function () {\r\n        const {contract_type} = state.category_displays.selected;\r\n        if (Lookback.isLookback(contract_type)) {\r\n          return false;\r\n        }\r\n        return formatPrice(((this.payout - this.ask_price) || 0), state.currency.value);\r\n      },\r\n      payout_: function () {\r\n        const {contract_type} = state.category_displays.selected;\r\n        if (Lookback.isLookback(contract_type)) {\r\n          return Lookback.formula(contract_type, formatPrice((+state.basis.amount || 0), state.currency.value, 3));\r\n        } else {\r\n          return formatPrice((+this.payout || 0), state.currency.value);\r\n        }\r\n      },\r\n      return_: function () {\r\n        const {contract_type} = state.category_displays.selected;\r\n        if (Lookback.isLookback(contract_type) || !this.payout || ! this.ask_price) {\r\n          return false;\r\n        }\r\n        return `${((this.payout - this.ask_price)/this.ask_price * 100).toFixed(1)}%`;\r\n      }\r\n    },\r\n    purchase: {\r\n      loading: false, /* is the purchased button clicked and confirmation dialog is loading */\r\n    },\r\n    tooltips: {\r\n      barrier: { my: \"left-215 top+10\", at: \"left bottom\", collision: \"flipfit\" },\r\n      barrier_p: { my: \"left-5 top+10\", at: \"left bottom\", collision: \"flipfit\" },\r\n    },\r\n    template: {\r\n      name: '',\r\n      visible: false,\r\n    },\r\n  };\r\n\r\n  var update_currency = function() {\r\n    /* change currency on user login */\r\n    if(liveapi.is_authenticated()) {\r\n      liveapi.send({ payout_currencies: 1 })\r\n             .then(function(data){\r\n               state.currency.value = data.payout_currencies[0];\r\n               state.currency.array = data.payout_currencies;\r\n            })\r\n             .catch(function(err) { console.error(err); });\r\n    }\r\n  };\r\n\r\n  state.template.hide = function(e) {\r\n    if($(e.target).closest('.trade-template-manager').length === 0) {\r\n      state.template.visible = false;\r\n    }\r\n  }\r\n  state.template.toggle = function() {\r\n    state.template.visible = !state.template.visible;\r\n  }\r\n\r\n  state.barriers.root = state; // reference to root object for computed properties\r\n\r\n  state.date_expiry.update_times = function(){\r\n      trading_times_for(state.date_expiry.value_date, state.proposal.symbol)\r\n        .then(function(times) {\r\n          state.date_expiry.today_times.open = times.open;\r\n          state.date_expiry.today_times.close = times.close;\r\n          var range = _(state.duration_unit.ranges).filter(['type', 'minutes']).head();\r\n          state.date_expiry.today_times.disabled = !range;\r\n          var value_hour = range ? moment.utc().add(range.min+1, 'm').format('HH:mm') : \"00:00\";\r\n          state.date_expiry.value_hour = value_hour;\r\n          // /* avoid 'Contract may not expire within the last 1 minute of trading.' */\r\n          // value_hour = moment(times.close, 'HH:mm:ss').subtract(1, 'minutes').format('HH:mm');\r\n          // expiry.value_hour = value_hour < expiry.value_hour ? value_hour : expiry.value_hour;\r\n      });\r\n  }\r\n\r\n  state.categories.update = function (msg) {\r\n    state.categories.value = _.find(state.categories.array,{contract_category: state.categories.selected});\r\n    var category = state.categories.value.contract_category;\r\n    var isInOut = v => ['staysinout', 'endsinout'].indexOf(v) !== -1;\r\n    const check = isInOut(category) ? el => isInOut(el.contract_category) : el => el.contract_category == category;\r\n    const isLookback = v => /^lookback$/.test(v.toLowerCase());\r\n    state.category_displays.array = [];\r\n    _(available).filter(check).map('contract_display').uniq().value().forEach(\r\n      x => {\r\n        let y = {};\r\n        y.name = x;\r\n        let category_object = _.find(available, {contract_display:x});\r\n        if (category_object){\r\n          y.sentiment = category_object.sentiment;\r\n          y.contract_type = category_object.contract_type;\r\n        }\r\n\r\n        state.category_displays.array.push(y);\r\n    });\r\n    if (isLookback(category)) {\r\n      state.basis.array = ['Multiplier'];\r\n      state.basis.value = 'multiplier';\r\n      state.currency.decimals = 3;\r\n    } else {\r\n      state.basis.array = ['Payout', 'Stake'];\r\n      state.basis.value = 'payout';\r\n      state.currency.decimals = currencyFractionalDigits();\r\n    }\r\n    state.category_displays.selected = _.head(state.category_displays.array);\r\n  };\r\n\r\n  state.category_displays.onclick = function (e) {\r\n    state.category_displays.selected = {};\r\n    state.category_displays.selected.name = $(e.target).attr('data-name');\r\n    state.category_displays.selected.sentiment = $(e.target).attr('data-sentiment');\r\n    state.category_displays.selected.contract_type = $(e.target).attr('data-contract_type');\r\n  };\r\n\r\n  state.date_start.update = function () {\r\n    const forward_starting_market = \r\n      _(available)\r\n        .filter({\r\n          'contract_category_display': state.categories.value.contract_category_display,\r\n          'contract_display': state.category_displays.selected.name,\r\n          'start_type': 'forward'\r\n        })\r\n        .head();\r\n\r\n    if (!forward_starting_market) {\r\n      _.assign(state.date_start, { visible: false, array: [], value: 'now' });\r\n      return;\r\n    };\r\n\r\n    const spot_starting_options = \r\n      _(available)\r\n        .filter({\r\n          'contract_category_display': state.categories.value.contract_category_display,\r\n          'contract_display': state.category_displays.selected.name,\r\n          'start_type': 'spot'\r\n        })\r\n        .head();\r\n\r\n    const start_dates = forward_starting_market.forward_starting_options.map((available_day) => {\r\n      const { date } = available_day;\r\n      const text = moment.unix(date).format('ddd - MMMM Do, YYYY');\r\n      return { text, value: date };\r\n    });\r\n\r\n    if (spot_starting_options) start_dates.unshift({ text: 'Now', value: 'now' });\r\n\r\n    const { value: selected_date } = state.date_start;\r\n  \r\n    const options = { \r\n      value: selected_date, \r\n      array: [...start_dates], \r\n      visible: true \r\n    };\r\n\r\n    _.assign(state.date_start, options);\r\n\r\n    if (selected_date === 'now') {\r\n      state.date_start.hour_minute = '00:00';\r\n    } else {\r\n      state.setDateStartHourMinute(state.date_start.hour_minute);\r\n    }\r\n  };\r\n\r\n  state.setDateStartHourMinute = (hour_minute) => {\r\n    const date_start_formatted                 = moment.unix(+state.date_start.value).format('YYYY-MM-DD');\r\n    const date_start_with_selected_hour_minute = moment.utc(`${date_start_formatted} ${hour_minute}`).unix();\r\n    const is_today                             = !moment.utc(date_start_formatted).isAfter(moment.utc(), 'day');\r\n\r\n    trading_times_for(date_start_formatted, state.proposal.symbol).then(data => {\r\n      state.date_start.today_times.open = data.open;\r\n      state.date_start.today_times.close = data.close;\r\n\r\n      if (is_today) {\r\n        const now_hour_minute = moment.utc().format('HH:mm');\r\n        state.date_start.hour_minute = now_hour_minute > hour_minute ? now_hour_minute : hour_minute;\r\n      } else {\r\n        state.date_start.hour_minute = hour_minute;\r\n      }\r\n\r\n      state.date_start.value = date_start_with_selected_hour_minute;\r\n    });\r\n  }\r\n\r\n  state.date_expiry.update = function (date_or_hour) {\r\n    /* contracts that are more not today must end at the market close time */\r\n    const { value_date } = state.date_expiry;\r\n    const is_today = !moment.utc(value_date).isAfter(moment.utc(), 'day');\r\n    const is_duration = state.duration.value === 'Duration';\r\n    const is_daily_contracts = state.duration_unit.array[0] && !hasIntradayUnit(state.duration_unit.array);\r\n\r\n    if (!is_today) {\r\n      state.date_expiry.today_times.disabled = true;\r\n        trading_times_for(value_date, state.proposal.symbol)\r\n          .then(function(times){\r\n            if (is_duration) {\r\n              state.date_expiry.value_date = moment.utc().format('YYYY-MM-DD');\r\n            }\r\n\r\n            const value_hour = times.close !== '--' ? times.close : '23:59:59';\r\n            state.date_expiry.min_date = is_daily_contracts ? 1 : 0;\r\n            state.date_expiry.value_hour = moment.utc(value_hour, 'HH:mm:ss').format('HH:mm');\r\n            state.date_expiry.value = moment.utc(state.date_expiry.value_date + ' ' + value_hour).unix();\r\n            state.barriers.update();\r\n\r\n            debounce(state.date_expiry.value, state.proposal.onchange);\r\n          });\r\n    }\r\n    else {\r\n        if (date_or_hour !== state.date_expiry.value_hour) { state.date_expiry.update_times(); }\r\n        if (is_daily_contracts && !is_duration) {\r\n          state.date_expiry.min_date = 1;\r\n          state.date_expiry.value_date = moment.utc().add(1, 'days').format('YYYY-MM-DD');\r\n        }\r\n        state.date_expiry.value = moment.utc(state.date_expiry.value_date + ' ' + state.date_expiry.value_hour).unix();\r\n        state.barriers.update();\r\n        debounce(state.date_expiry.value, state.proposal.onchange);\r\n    }\r\n  }\r\n\r\n  state.duration.update = function () {\r\n    var category = state.categories.value.contract_category;\r\n    if (_([\"callput\", \"endsinout\", \"staysinout\", \"touchnotouch\", \"lookback\"]).includes(category)) {\r\n      if(state.duration.array.length !== 2)\r\n        state.duration.array = ['Duration', 'End Time'];\r\n    }\r\n    else {\r\n      state.duration.value = 'Duration';\r\n      if(state.duration.array.length !== 1)\r\n        state.duration.array = ['Duration'];\r\n    }\r\n  };\r\n\r\n  state.duration_unit.update = function () {\r\n    var start_type = state.date_start.value !== 'now' ? 'forward' : 'spot';\r\n    var durations = _(available).filter({\r\n      'contract_category_display': state.categories.value.contract_category_display,\r\n      'contract_display': state.category_displays.selected.name,\r\n      'start_type': start_type\r\n    })\r\n    .map(function (r) {\r\n      return {\r\n        min: r.min_contract_duration + '',\r\n        max: r.max_contract_duration + '',\r\n        type: r.expiry_type\r\n      }\r\n    }).value();\r\n\r\n    var array = [];\r\n    var ranges = [];\r\n    _.each(durations, function (d) {\r\n      if (_(['tick', 'daily']).includes(d.type)) {\r\n        array.push({ tick: 'ticks', daily: 'days' }[d.type]);\r\n        ranges.push({\r\n          min: d.min.replace('d', '').replace('t','') | 0,\r\n          max: d.max.replace('d', '').replace('t','') | 0,\r\n          type: { tick: 'ticks', daily: 'days' }[d.type]\r\n        });\r\n        return;\r\n      }\r\n      /* fix intraday duration intervals */\r\n      var min = d.min.replace('s', '').replace('m', '').replace('h',''),\r\n          max = d.max.replace('s', '').replace('m', '').replace('h','').replace('d', '');\r\n      var min_unit = _(d.min).last(),\r\n          max_unit = _(d.max).last();\r\n\r\n      min *= { 's': 1, 'm': 60, 'h': 3600 }[min_unit];                 // convert to seconds\r\n      max *= { 's': 1, 'm': 60, 'h':3600, 'd': 3600 * 24 }[max_unit];\r\n\r\n      if('s' === min_unit) {\r\n        array.push('seconds');\r\n        ranges.push({ min: min, max: max, type: 'seconds'});\r\n      }\r\n      if(_(['s', 'm']).includes(min_unit) && max >= 60) {\r\n        array.push('minutes');\r\n        ranges.push({ min: Math.max(min / 60, 1), max: max / 60, type: 'minutes' });\r\n      }\r\n      if(_(['s', 'm', 'h']).includes(min_unit) && max >= 3600) {\r\n        array.push('hours');\r\n        ranges.push({ min: Math.max(min / 3600, 1), max: max / 3600, type: 'hours' });\r\n      }\r\n    });\r\n\r\n    /* sort the arrays */\r\n    var sort_dict = { 'ticks': 0, 'seconds': 1, 'minutes': 2, 'hours': 3, 'days': 4 };\r\n    array.sort(function (r1, r2) { return sort_dict[r1] - sort_dict[r2]; });\r\n    ranges.sort(function(r1,r2){ return sort_dict[r1.type] - sort_dict[r2.type]; })\r\n\r\n    if (!array.length) {\r\n      state.barriers.update();\r\n      return;\r\n    }\r\n\r\n    state.duration_unit.ranges = ranges;\r\n    if(!_.includes(array,state.duration_unit.value)){\r\n      state.duration_unit.value = _.head(array);\r\n    }\r\n    else {\r\n      state.duration_count.update(true);\r\n    }\r\n    // disable other durations besides minutes for lookbacks\r\n    if (state.categories.selected === 'lookback') {\r\n      array = array.filter((duration) => duration === 'minutes')\r\n    }\r\n\r\n    state.duration_unit.array = array;\r\n    /* manualy notify 'duration_count' and 'barriers' to update themselves */\r\n    state.barriers.update();\r\n    state.date_expiry.update_times();\r\n  };\r\n\r\n  state.duration_count.update = function (try_to_keep_value) {\r\n    var range = _(state.duration_unit.ranges).filter({'type': state.duration_unit.value}).head();\r\n    if (!range) return;\r\n    state.duration_count.min = range.min;\r\n    state.duration_count.max = range.max;\r\n    if(try_to_keep_value !== true) {\r\n      state.duration_count.value = range.min;\r\n    }\r\n    else if(state.duration_count.value < range.min || state.duration_count.value > range.max) {\r\n      state.duration_count.value = range.min;\r\n    }\r\n  };\r\n\r\n  state.digits.update = function() {\r\n      var subcat = state.category_displays.selected.sentiment;\r\n      if(state.categories.value.contract_category !== 'digits' || subcat === 'odd' || subcat === 'even') {\r\n        state.digits.visible = false;\r\n        return;\r\n      }\r\n\r\n      var array = {\r\n        match: ['0', '1','2','3','4','5','6','7','8', '9'],\r\n        differ: ['0', '1','2','3','4','5','6','7','8', '9'],\r\n        under: ['1','2','3','4','5','6','7','8', '9'],\r\n        over: ['0','1','2','3','4','5','6','7','8'],\r\n      }[subcat];\r\n      var text = {\r\n        match: 'Last Digit Prediction'.i18n(),\r\n        differ: 'Last Digit Prediction'.i18n(),\r\n        under: 'Last Digit is Under'.i18n(),\r\n        over: 'Last Digit is Over'.i18n()\r\n      }[subcat];\r\n\r\n      if(!_.includes(array, state.digits.value)){\r\n        state.digits.value = array[0];\r\n      }\r\n      state.digits.array = array;\r\n      state.digits.text = text;\r\n      state.digits.visible = true;\r\n  };\r\n\r\n  state.barriers.update = function () {\r\n    var unit = state.duration_unit.value;\r\n    var expiry_type = _(['seconds', 'minutes', 'hours']).includes(unit) ? 'intraday' : unit === 'days' ? 'daily' : 'tick';\r\n    var barriers = _(available).filter({\r\n      'contract_category_display': state.categories.value.contract_category_display,\r\n      'contract_display': state.category_displays.selected.name,\r\n      'expiry_type':expiry_type\r\n    }).filter(function (r) { return r.barriers >= 1; }).head();\r\n\r\n    state.barriers.barrier_count = barriers ? barriers.barriers : 0;\r\n    if (!barriers)\r\n      return;\r\n\r\n     var update_barrier = function(barrier, perv_barrier, new_barrier, was_perv_barrier_daily, sign) {\r\n        var is_daily = (expiry_type === 'daily' && state.duration.value !== 'End Time') ||\r\n           (state.duration.value === 'End Time' && moment.utc(state.date_expiry.value_date).isAfter(moment.utc(),'day'));\r\n        if(is_daily) {\r\n           if(was_perv_barrier_daily) {\r\n              perv_barrier = barrier;\r\n           }\r\n           barrier = (was_perv_barrier_daily ? barrier : 0) || new_barrier;\r\n           was_perv_barrier_daily = true;\r\n        }\r\n        else {\r\n           var def_barrier = (new_barrier*1 >= 0 ? sign : '') + new_barrier*1;\r\n           if(was_perv_barrier_daily && /^[+-]/.test(perv_barrier)) {\r\n              barrier = perv_barrier;\r\n           }\r\n           else if(!/^[+-]/.test(barrier)) {\r\n              barrier = def_barrier;\r\n           }\r\n           else {} // no need to update it\r\n           perv_barrier = barrier;\r\n           was_perv_barrier_daily = false;\r\n        }\r\n        return {\r\n           barrier: barrier,\r\n           perv_barrier: perv_barrier,\r\n           was_perv_barrier_daily: was_perv_barrier_daily\r\n        };\r\n     }\r\n    if(barriers.barrier) {\r\n       var result = update_barrier(state.barriers.barrier, state.barriers.perv_barrier,\r\n          barriers.barrier, state.barriers.was_perv_barrier_daily, '+');\r\n       state.barriers.barrier = result.barrier;\r\n       state.barriers.perv_barrier = result.perv_barrier;\r\n       state.barriers.was_perv_barrier_daily = result.was_perv_barrier_daily;\r\n    }\r\n    if(barriers.high_barrier){\r\n       var result = update_barrier(state.barriers.high_barrier, state.barriers.perv_high_barrier,\r\n          barriers.high_barrier, state.barriers.was_perv_high_barrier_daily, '+');\r\n       state.barriers.high_barrier = result.barrier;\r\n       state.barriers.perv_high_barrier = result.perv_barrier;\r\n       state.barriers.was_perv_high_barrier_daily = result.was_perv_barrier_daily;\r\n    }\r\n    if(barriers.low_barrier){\r\n       var result = update_barrier(state.barriers.low_barrier, state.barriers.perv_low_barrier,\r\n          barriers.low_barrier, state.barriers.was_perv_low_barrier_daily, '-');\r\n       state.barriers.low_barrier = result.barrier;\r\n       state.barriers.perv_low_barrier = result.perv_barrier;\r\n       state.barriers.was_perv_low_barrier_daily = result.was_perv_barrier_daily;\r\n    }\r\n  };\r\n\r\n  state.basis.update_limit = function () {\r\n    var basis = state.basis;\r\n    var limit = _(available).filter({\r\n      'contract_category_display': state.categories.value.contract_category_display,\r\n      'contract_display': state.category_displays.selected.name\r\n    }).head();\r\n\r\n    limit = (limit && limit.payout_limit) || null;\r\n    basis.limit = limit ? (limit * 1) : null;\r\n    if(basis.limit) {\r\n      basis.amount = Math.min(basis.amount, basis.limit);\r\n    }\r\n  };\r\n\r\n  state.proposal.onchange = function () {\r\n    const unit = state.duration_unit.value;\r\n    let expiry_type = _(['seconds', 'minutes', 'hours']).includes(unit) ? 'intraday' : unit === 'days' ? 'daily' : 'tick';\r\n    const subcat = state.category_displays.selected.sentiment;\r\n    if(state.categories.value.contract_category === 'spreads') expiry_type = 'intraday';\r\n    const row = _(available).filter({\r\n      'contract_category_display': state.categories.value.contract_category_display,\r\n      'contract_display': state.category_displays.selected.name,\r\n      'expiry_type': expiry_type\r\n    }).head();\r\n    const request = {\r\n      proposal: 1,\r\n      subscribe: 1,\r\n      contract_type: row ? row.contract_type : '',\r\n      currency: state.currency.value, /* This can only be the account-holder's currency */\r\n      symbol: state.proposal.symbol, /* Symbol code */\r\n    };\r\n    if(state.categories.value.contract_category !== 'spreads') {\r\n      const format_amount = _.isNil(state.basis.amount) ? false : state.basis.amount.toString().match(/0*(\\d+\\.?\\d*)/);\r\n      //  format the amount only if the invalid input is invalid\r\n      if (format_amount && format_amount.input !== format_amount[1]) {\r\n        state.basis.amount = format_amount[1];\r\n      }\r\n      request.amount = state.basis.amount; /* Proposed payout or stake value */\r\n      request.basis = state.basis.value; /* Indicate whether amount is 'payout' or 'stake */\r\n    } else {\r\n      request.amount_per_point = state.spreads.amount_per_point;\r\n      request.stop_type = state.spreads.stop_type;\r\n      request.stop_loss = state.spreads.stop_loss;\r\n      request.stop_profit = state.spreads.stop_profit;\r\n    }\r\n\r\n    add_barriers_to_request(state, request);\r\n    set_is_barrier_offset(state);\r\n\r\n    if (state.categories.value.contract_category === 'digits' && !(subcat === 'odd' || subcat === 'even')) {\r\n      request.barrier = state.digits.value + '';\r\n    }\r\n    if (state.date_start.value !== 'now') {\r\n      request.date_start = state.date_start.value * 1;\r\n    }\r\n    /* set value for duration or date_expiry */\r\n    if (state.duration.value === 'Duration') {\r\n      request.duration_unit = _(state.duration_unit.value).head(); //  (d|h|m|s|t), Duration unit is s(seconds), m(minutes), h(hours), d(days), t(ticks)\r\n      request.duration = state.duration_count.value * 1;\r\n    }\r\n    else {\r\n      request.date_expiry = state.date_expiry.value;\r\n    }\r\n\r\n    state.proposal.loading = true;\r\n    /* forget previous proposal request */\r\n    if(state.proposal.last_promise) {\r\n      state.proposal.last_promise.then(function(data){\r\n        var id = data && data.proposal && data.proposal.id;\r\n        id && liveapi.send({forget: id});\r\n      });\r\n    }\r\n\r\n    async function subscribeProposalHandler(request, times_to_retry, required_err_code_for_retry) {\r\n      let response;\r\n      for (let i = 0; i < times_to_retry; i++) {\r\n        try {\r\n          const { contract_type } = state.category_displays.selected;\r\n          if (Lookback.isLookback(contract_type)) {\r\n            const lookback_request = Lookback.makeLookbackRequest(request);\r\n            response = await liveapi.send(lookback_request);\r\n          } else {\r\n            response = await liveapi.send(request);\r\n          }\r\n          state.proposal.error = '';\r\n          state.proposal.id = response.proposal && response.proposal.id;\r\n          break;\r\n        } catch (err) {\r\n          state.proposal.error = err.message;\r\n          state.proposal.message = '';\r\n          state.proposal.loading = false;\r\n          if (required_err_code_for_retry && required_err_code_for_retry !== err.code) { break; }\r\n        }\r\n      }\r\n      return response;\r\n    }\r\n\r\n    const new_proposal_promise = subscribeProposalHandler(request, 2, 'AlreadySubscribed');\r\n    /* update last_promise to invalidate previous requests */\r\n    state.proposal.last_promise = new_proposal_promise;\r\n    state.proposal.id = ''; /* invalidate last proposal.id */\r\n\r\n    dialog.update_track(dialog.get_template());\r\n  };\r\n\r\n  function add_barriers_to_request(state, request) {\r\n    const { barrier, high_barrier, low_barrier, barrier_count } = state.barriers;\r\n    if (+barrier_count === 2) {\r\n      request.barrier = high_barrier;\r\n      request.barrier2 = low_barrier;\r\n      return;\r\n    }\r\n    if (+barrier_count === 1) request.barrier = barrier;\r\n  }\r\n\r\n  function set_is_barrier_offset(state) {\r\n    state.barriers.is_offset_barrier = is_offset(state.barriers.barrier);\r\n    state.barriers.is_offset_low_barrier = is_offset(state.barriers.low_barrier);\r\n    state.barriers.is_offset_high_barrier = is_offset(state.barriers.high_barrier);\r\n  }\r\n\r\n  function is_offset(barrier) {\r\n    return barrier && (barrier.startsWith('+') || barrier.startsWith('-')) ? true : false;\r\n  }\r\n\r\n  state.purchase.onclick = async function() {\r\n    const categories_with_tick_chart = ['digits', 'callput', 'callputequal', 'asian', 'touchnotouch'];\r\n    state.purchase.loading = true;\r\n    var show = function(div){\r\n      div.appendTo(root);\r\n\r\n      root.find('.trade-fields').css({ left : '400px'});\r\n      root.find('.trade-conf').css({ left : '0'});\r\n    };\r\n    var hide = function(div){\r\n      root.find('.trade-fields').css({ left : '0'});\r\n      root.find('.trade-conf').css({ left : '-400px'});\r\n      state.purchase.loading = false;\r\n      div.remove();\r\n      /* trigger a new proposal stream */\r\n      state.proposal.onchange();\r\n    }\r\n\r\n    /* workaround for api not providing this fields */\r\n    var extra = {\r\n        amount: state.basis.amount,\r\n        currency: state.currency.value,\r\n        symbol: state.proposal.symbol,\r\n        symbol_name: state.proposal.symbol_name,\r\n        category: state.categories.value,\r\n        category_display: state.category_displays.selected,\r\n        duration_unit: state.duration_unit.value,\r\n        pip: symbol.pip,\r\n    };\r\n    /* pass data which is needed to show live tick purchase results */\r\n    extra.show_tick_chart = false;\r\n    if(_(categories_with_tick_chart).includes(extra.category.contract_category) && state.duration.value === 'Duration' && extra.duration_unit === 'ticks') {\r\n        extra.digits_value = state.digits.value;\r\n        extra.tick_count = state.duration_count.value*1;\r\n        if(extra.category.contract_category !== 'digits') {\r\n          if (extra.category.contract_category !== 'asian') {\r\n            extra.tick_count += 1; /* we are shwoing X ticks arfter the initial tick so the total will be X+1 */\r\n          }\r\n          /* for higher/lower final barrier value is entry_quote + barrrier */\r\n          if(extra.category.contract_category === 'callput' && !_(['rise','fall']).includes(extra.category_display.name)) {\r\n            extra.barrier = state.barriers.barrier;\r\n          }\r\n          extra.show_tick_chart = true;\r\n        }\r\n    }\r\n    // manually check to see if the user is authenticated or not,\r\n    // we should update state.currency from user profile first (not everyone is using USD)\r\n    if(!liveapi.is_authenticated()) {\r\n        $.growl.warning({ message: 'Please log in'.i18n() });\r\n        state.purchase.loading = false;\r\n        return;\r\n    }\r\n    try {\r\n        const [tradeConf] = await require(['trade/tradeConf']);\r\n        const data = await liveapi.send({\r\n                buy: state.proposal.id,\r\n                price: state.proposal.ask_price * 1,\r\n             });\r\n        extra.contract_id = data.buy.contract_id;\r\n        extra.transaction_id = data.buy.transaction_id;\r\n        if(extra.show_tick_chart || extra.category.contract_category === 'digits') {\r\n          liveapi.proposal_open_contract.subscribe(extra.contract_id);\r\n        }\r\n        tradeConf.init(data, extra, show, hide, symbol);\r\n    }\r\n    catch(err) {\r\n        state.purchase.loading = false;\r\n        $.growl.error({ message: err.message });\r\n        console.error(err);\r\n        /*Logout if the error code is 42*/\r\n        if (err.code === 'InvalidToken') {\r\n          liveapi.invalidate();\r\n        } else {\r\n          /* trigger a new proposal stream */\r\n          state.proposal.onchange();\r\n        }\r\n    }\r\n  };\r\n\r\n  _(available)\r\n    .map('contract_category')\r\n    .uniq()\r\n    .value()\r\n    // TODO: Remove this filter after implementing reset, high/low, spread, runs contracts.\r\n    .filter(f => SUPPORTED_CONTRACT_TYPES.includes(f.toLowerCase()))\r\n    .forEach(x => {\r\n      let y = {};\r\n      y.contract_category = x;\r\n      let contract_object = _.find(available, {contract_category: x});\r\n      if (contract_object) {\r\n        y.contract_category = contract_object.contract_category;\r\n        y.contract_category_display = contract_object.contract_category_display\r\n        state.categories.array.push(y);\r\n      }\r\n    });\r\n\r\n  state.categories.value = _(state.categories.array).head(); // TODO: show first tab\r\n  state.categories.selected = state.categories.value.contract_category;\r\n\r\n  var tick_stream_alive = false;\r\n  /* register for tick stream of the corresponding symbol */\r\n  liveapi.events.on('tick', function (data) {\r\n      if (data.tick && data.tick.symbol == state.proposal.symbol) {\r\n          tick_stream_alive = true;\r\n          // if(state.purchase.loading) return; /* don't update ui while loading confirmation dialog */\r\n          state.tick.perv_quote = state.tick.quote;\r\n          state.tick.epoch = data.tick.epoch;\r\n          state.tick.quote = data.tick.quote;\r\n          state.ticks.loading = false;\r\n          /* update ticks for sparkline chart */\r\n          if(state.ticks.array.length > 25) {\r\n            state.ticks.array.shift();\r\n          }\r\n          state.ticks.array.push(data.tick);\r\n      }\r\n  });\r\n  /* register for proposal event */\r\n  liveapi.events.on('proposal', function (data) {\r\n      // Specifically for microsoft products. Need to wait for other functions to finish\r\n      //We can move the code out of the defer function once windows becomes obsolete or if it stops making browsers. >.<\r\n      _.defer(function(){\r\n          if (!data.proposal || data.proposal.id !== state.proposal.id) return;\r\n          if(data.error){\r\n            console.error(data.error);\r\n            state.proposal.error = data.error.message;\r\n            state.proposal.message = '';\r\n            return;\r\n          }\r\n          if(state.purchase.loading) return; /* don't update ui while loading confirmation dialog */\r\n          /* update fields */\r\n          var proposal = data.proposal;\r\n          state.proposal.ask_price = proposal.ask_price;\r\n          state.proposal.date_start = proposal.date_start;\r\n          state.proposal.multiplier = proposal.multiplier || '0';\r\n          state.proposal.display_value = proposal.display_value;\r\n          state.proposal.message = proposal.longcode;\r\n          state.proposal.payout = proposal.payout;\r\n          state.proposal.spot = proposal.spot;\r\n          state.proposal.spot_time = proposal.spot_time;\r\n          state.spreads.spread = proposal.spread || 0.0;\r\n          state.spreads.spot = proposal.spot || '0.0';\r\n          state.spreads.spot_time = proposal.spot_time || '0';\r\n          state.proposal.loading = false;\r\n          if(!tick_stream_alive && proposal.spot) { /* for contracts that don't have live qoute data */\r\n            state.tick.epoch = proposal.spot_time;\r\n            state.tick.quote = proposal.spot;\r\n          }\r\n      });\r\n  });\r\n\r\n  liveapi.events.on('set_account_currency', update_currency);\r\n  liveapi.events.on('login', update_currency);\r\n\r\n  update_currency();\r\n\r\n  return state;\r\n}\r\nexport function init(symbol, contracts_for, saved_template, isTrackerInitiated) {\r\n    var root = $(html).i18n();\r\n    var available = apply_fixes(contracts_for.available);\r\n\r\n    var dialog = windows.createBlankWindow(root, {\r\n        title: symbol.display_name,\r\n        resizable: false,\r\n        collapsable: false,\r\n        minimizable: true,\r\n        maximizable: false,\r\n        width:  400,\r\n        'data-authorized': 'false',\r\n        'data-account-specific': 'true',\r\n        isTrackerInitiated: isTrackerInitiated,\r\n        relativePosition: true,\r\n        close: function() {\r\n          /* forget last proposal stream on close */\r\n          if(state.proposal.last_promise) {\r\n            state.proposal.last_promise.then(function(data){\r\n              var id = data && data.proposal && data.proposal.id;\r\n              id && liveapi.send({forget: id});\r\n            });\r\n          }\r\n          chartingRequestMap.unregister(key);\r\n          view.unbind();\r\n          dialog.destroy();\r\n        }\r\n    });\r\n    var update_track = dialog.track({\r\n      module_id: 'tradeDialog',\r\n      is_unique: false,\r\n      data: {\r\n        symbol : symbol,\r\n        template: saved_template || {}\r\n      }\r\n    });\r\n\r\n    /********************** register for ticks_streams **********************/\r\n    var key = chartingRequestMap.keyFor(symbol.symbol, /* granularity = */ 0);\r\n    var has_digits = _(available).map('min_contract_duration')\r\n                      .some(function(duration){ return /^\\d+$/.test(duration) || (_.last(duration) === 't'); });\r\n    if(!chartingRequestMap[key]){ /* don't register if already someone else has registered for this symbol */\r\n        chartingRequestMap.register({\r\n          symbol: symbol.symbol,\r\n          subscribe: 1,\r\n          style: 'ticks'\r\n        }).catch(function (err) {\r\n          /* if this contract offers tick trades, prevent user from trading */\r\n          if(has_digits) {\r\n            $.growl.error({ message: err.message });\r\n            _.delay(function(){ dialog.dialog('close'); },2000);\r\n          }\r\n          console.error(err);\r\n        });\r\n    }\r\n    else { chartingRequestMap.subscribe(key); }\r\n\r\n    var state = init_state(available,root,dialog, symbol, contracts_for.spot);\r\n    if(!has_digits) { state.ticks.loading = false; }\r\n    var view = rv.bind(root[0],state);\r\n    state.categories.update();            // trigger update to init categories_display submenu\r\n\r\n    dialog.dialog('open');\r\n\r\n    dialog.update_track = function(template) {\r\n      update_track({symbol: symbol, template: template});\r\n    };\r\n    dialog.get_template = get_current_template.bind(undefined, state);\r\n    dialog.set_template = set_current_template.bind(undefined, state);\r\n    saved_template && (saved_template.name !== undefined) && dialog.set_template(saved_template);\r\n    dialog.hide_template_menu = () => { state.template.visible = false; };\r\n    require(['trade/tradeTemplateManager'], function(tradeTemplateManager) {\r\n      tradeTemplateManager.init(root.find('.trade-template-manager-root'), dialog);\r\n    });\r\n    $('#duration-input').keypress((evt) => {\r\n      if ((evt.which < 48 || evt.which > 57) && evt.which !== 8) {\r\n          evt.preventDefault();\r\n      }\r\n    });\r\n    // window.state = state; window.av = available; window.moment = moment; window.dialog = dialog; window.times_for = trading_times_for;\r\n    return dialog; // used in tracker to set position.\r\n}\r\n\r\nexport default { init, };\r\n"]}